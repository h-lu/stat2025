---
title: "第五周实验：假设检验实践 (t-检验与 ANOVA)"
execute:
  echo: true
  warning: false
  message: false
---

## 1. 目标

本实验旨在通过实践应用，熟练掌握单样本 t 检验、双独立样本 t 检验、配对样本 t 检验以及单因素方差分析 (ANOVA) 的 R 实现和结果解读。

-   根据问题场景选择合适的假设检验方法。
-   使用 `t.test()` 执行各种 t 检验，并解释 P 值和置信区间。
-   理解并检查 t 检验和 ANOVA 的假设条件（特别是正态性和方差齐性）。
-   使用 `aov()` 和 `summary()` 执行 ANOVA，并解读 ANOVA 表。
-   在 ANOVA 结果显著后，使用 `TukeyHSD()` 进行事后检验，找出具体差异。

## 2. 数据准备

我们将使用 R 内置数据集和一些模拟数据进行练习。

```r
library(tidyverse)
library(ggplot2)
library(car) # 用于 Levene's Test

# 查看内置数据集 sleep (比较两种安眠药的效果)
# ?sleep
glimpse(sleep)
head(sleep)

# 模拟一些单样本数据 (例如，一批零件的长度，已知标准为 10cm)
set.seed(123)
part_lengths <- rnorm(25, mean = 10.1, sd = 0.2) # 模拟 25 个零件，均值略偏离 10

# 模拟 ANOVA 数据 (例如，三种不同教学方法 A, B, C 的学生得分)
set.seed(456)
scores_A <- rnorm(20, mean = 75, sd = 5)
scores_B <- rnorm(20, mean = 80, sd = 5)
scores_C <- rnorm(20, mean = 78, sd = 5)

anova_sim_data <- tibble(
  Score = c(scores_A, scores_B, scores_C),
  Method = factor(rep(c("A", "B", "C"), each = 20))
)
```

## 3. 单样本 t 检验 (`t.test`)

**场景:** 假设已知零件的标准长度应为 10cm。我们抽取了 25 个零件样本 (`part_lengths`)，想要检验这批零件的平均长度是否**显著不等于** 10cm。

**任务:**

1. 陈述原假设 ($H_0$) 和备择假设 ($H_1$)。
2. (可选) 检查数据的正态性假设（例如，使用 QQ 图或 Shapiro-Wilk 检验）。
3. 使用 `t.test()` 对 `part_lengths` 进行单样本 t 检验，检验均值是否等于 10。
4. 解读检验结果：t 值、自由度、P 值、置信区间、样本均值估计。
5. 根据 P 值和选择的显著性水平 $\alpha = 0.05$ 做出决策。
6. 用通俗语言解释结论。


## 4. 双独立样本 t 检验 (`t.test`)

**场景:** 我们想比较两种不同的肥料（A 和 B）对作物产量 (`yield`) 的影响是否有显著差异。假设我们有两组独立的样本数据。

**模拟数据:**

```r
set.seed(789)
yield_fertA <- rnorm(15, mean = 50, sd = 8)
yield_fertB <- rnorm(18, mean = 56, sd = 7)
```

**任务:**

1. 陈述原假设 ($H_0$) 和备择假设 ($H_1$)。
2. (可选) 分别检查两组数据的正态性。
3. **检查方差齐性假设** (使用 Levene's Test 或 `var.test()`)。
4. 根据方差齐性检验结果，选择合适的 `t.test()` 参数 (`var.equal = TRUE` 或 `FALSE`，推荐默认 `FALSE` 即 Welch's test)。执行双独立样本 t 检验。
5. 解读检验结果：t 值 (或 Welch's t)、自由度、P 值、置信区间 (针对均值差)、样本均值估计。
6. 根据 P 值和 $\alpha = 0.05$ 做出决策。
7. 用通俗语言解释结论。


## 5. 配对样本 t 检验 (`t.test`)

**场景:** 使用 R 内置的 `sleep` 数据集。该数据集记录了 10 位病人在分别使用两种安眠药（`group`=1 和 `group`=2）后，相比未使用药物时额外睡眠时间的变化 (`extra`)。我们想检验这两种药物的效果是否有显著差异。这是一个典型的配对样本设计，因为每个病人都尝试了两种药物。

**任务:**

1. 陈述原假设 ($H_0$) 和备择假设 ($H_1$)。
2. (可选) 检查**配对差值**的正态性。
3. 使用 `t.test()` 对 `sleep` 数据进行配对样本 t 检验 (比较 `group` 1 和 2 的 `extra` 值)。设置 `paired = TRUE`。
4. 解读检验结果：t 值、自由度、P 值、置信区间 (针对**差值的均值**)、差值的样本均值估计。
5. 根据 P 值和 $\alpha = 0.05$ 做出决策。
6. 用通俗语言解释结论。


## 6. 单因素 ANOVA 与事后检验

**场景:** 使用我们之前模拟的 `anova_sim_data`，比较三种不同教学方法 (A, B, C) 的学生平均得分 (`Score`) 是否存在显著差异。

**任务:**

1. 陈述 ANOVA 的原假设 ($H_0$) 和备择假设 ($H_1$)。
2. (可选) 检查各组数据的正态性。
3. **检查方差齐性假设** (使用 Levene's Test)。
4. 使用 `aov()` 拟合 ANOVA 模型。
5. 使用 `summary()` 查看 ANOVA 表，并解读 F 值和 P 值。
6. 根据 ANOVA 的 P 值和 $\alpha = 0.05$ 做出初步决策。
7. 如果 ANOVA 结果显著 (P \< 0.05)，则使用 `TukeyHSD()` 进行事后检验。
8. 解读 TukeyHSD 的结果（调整后的 P 值和置信区间），判断具体哪些组之间存在显著差异。
9. 用通俗语言总结最终结论。

## 7. 实验总结

在本实验中，我们针对不同的研究场景，实践了四种核心的假设检验方法：单样本 t 检验、双独立样本 t 检验、配对样本 t 检验和单因素方差分析 (ANOVA) 及其事后检验。我们重点练习了如何在 R 中实现这些检验，并根据输出结果（特别是 P 值和置信区间）做出统计决策和解释结论。同时，我们也强调了在应用这些方法前检查相关假设条件（如正态性、方差齐性）的重要性。