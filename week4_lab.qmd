---
title: "第四周实验：`ggplot2` 可视化探索"
execute:
  echo: true
  warning: false
  message: false
---

## 1. 目标

本实验旨在通过实践 `ggplot2` 包，熟练掌握创建常用统计图形进行探索性数据分析 (EDA) 的技能，并练习基本的图形定制。

-   回顾 `ggplot2` 的图层语法。
-   练习绘制单变量图形：直方图、密度图、箱线图。
-   练习绘制双变量图形：散点图、分组箱线图/小提琴图、条形图。
-   使用 `labs()` 添加标题和标签。
-   使用 `theme_...()` 应用不同的视觉主题。
-   (可选) 结合 `dplyr` 进行数据汇总后再绘图。

## 2. 数据准备

我们将主要使用 `ggplot2` 内置的 `mpg` 数据集。确保 `tidyverse` 已加载。

```r
library(tidyverse)
library(ggplot2) # ggplot2 包含在 tidyverse 中，但显式加载有时有助于代码清晰

# 查看 mpg 数据集结构
glimpse(mpg)
# ?mpg # 查看帮助文档
```

## 3. 单变量可视化练习

探索单个变量的分布特征。

### 3.1 直方图 (`geom_histogram`)

**任务:** 

1. 绘制变量 `cty` (城市里程/加仑) 的直方图。
2. 尝试调整 `binwidth` 参数（例如 `binwidth = 2` 或 `binwidth = 5`），观察图形的变化。
3. 为直方图添加填充色 (`fill`) 和边框色 (`color`)。


### 3.2 密度图 (`geom_density`)

**任务:**

1. 绘制变量 `hwy` (高速公路里程/加仑) 的密度图。
2. 添加填充色，并使用 `alpha` 参数设置透明度。
3. (可选挑战) 在同一张图上绘制不同 `drv` (驱动方式) 的 `hwy` 密度图，使用 `fill` 映射到 `drv` 并设置 `alpha`。


### 3.3 箱线图 (`geom_boxplot`)

**任务:**

1. 绘制变量 `displ` (发动机排量) 的箱线图。
2. 绘制按 `class` (车辆类别) 分组的 `hwy` (高速公路里程) 的箱线图。
3. 将上一步的箱线图翻转，使类别标签在 Y 轴上，更易阅读 (`coord_flip()`)。
4. (可选挑战) 在分组箱线图上叠加 `geom_jitter()`，显示原始数据点（设置 `alpha` 和 `width`）。



## 4. 双变量可视化练习

探索两个变量之间的关系。

### 4.1 散点图 (`geom_point`)

**任务:**

1. 绘制 `displ` (发动机排量) 和 `cty` (城市里程) 的散点图。
2. 在散点图上，将点的**颜色**映射到 `drv` (驱动方式)。
3. 在散点图上，将点的**大小**映射到 `cyl` (气缸数)。
4. (可选挑战) 添加一条线性拟合线 (`geom_smooth(method = "lm")`)。


### 4.2 条形图 (`geom_bar` / `geom_col`)

**任务:** 

1. 使用 `geom_bar()` 统计 `drv` (驱动方式) 的频数并绘制条形图。
2. (结合 `dplyr`) 先计算每个 `manufacturer` (制造商) 的平均 `hwy` (高速公路里程)，然后使用 `geom_col()` 绘制条形图展示结果，并按平均里程排序。


## 5. 图形定制练习 (`labs` & `theme`)

**任务:** 选择你之前绘制的任意一个图形，进行以下定制：

1. 使用 `labs()` 添加一个有意义的 `title`, `subtitle`, `x` 轴标签, `y` 轴标签, 以及 `caption`。
2. 尝试应用不同的内置主题，如 `theme_bw()`, `theme_minimal()`, `theme_classic()`, `theme_light()`，观察效果。


## 6. 实验总结

在本实验中，我们通过 `mpg` 数据集实践了 `ggplot2` 的核心功能。我们练习了绘制用于探索单变量分布的直方图、密度图和箱线图，以及用于探索双变量关系的散点图和条形图（包括分组比较）。我们还学习了如何使用 `labs()` 和 `theme_...()` 对图形进行基本定制，使其更具信息量和美观性。熟练掌握 `ggplot2` 是进行有效数据探索和结果沟通的关键技能。