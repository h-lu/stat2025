---
title: "第六周实验：相关与简单线性回归实践"
execute:
  echo: true
  message: false
  warning: false
---

## 1. 目标

本实验旨在练习计算和解释相关系数，使用散点图可视化变量关系，并拟合和解释简单的线性回归模型。

-   使用 `cor()` 计算 Pearson 和 Spearman 相关系数。
-   使用 `cor.test()` 对相关性进行显著性检验并解释结果。
-   使用 `ggplot2::geom_point()` 和 `geom_smooth()` 创建和解读散点图。
-   理解相关不等于因果。
-   使用 `lm()` 拟合简单线性回归模型。
-   解读 `summary(lm())` 的输出，特别是系数、P 值和 R²。

## 2. 数据准备

我们将继续使用 `mpg` 数据集，并可能使用 `mtcars` 数据集。

```r
library(tidyverse)
library(ggplot2)
library(GGally) # 用于绘制散点图矩阵

# glimpse(mpg)
# glimpse(mtcars)
```

## 3. 相关分析练习

### 3.1 计算与可视化

**场景:** 我们想探索 `mpg` 数据集中几个连续变量之间的关系，例如 `displ` (排量), `cty` (城市里程), `hwy` (高速里程)。

**任务:** 

1. 绘制 `displ` 和 `hwy` 的散点图，并在图上添加一条线性拟合线 (`method = "lm"`) 和一条非线性平滑曲线 (默认 `geom_smooth`)。观察它们的关系是线性的吗？
2. 计算 `displ` 和 `hwy` 之间的 Pearson 相关系数。
3. 计算 `displ` 和 `hwy` 之间的 Spearman 相关系数。比较两者的大小，思考为何可能有差异。
4. (可选挑战) 使用 `GGally::ggpairs()` 函数创建一个散点图矩阵，可视化多个连续变量（如 `displ`, `cty`, `hwy`, `cyl`）之间的两两关系和各自的分布。 (需要先 `install.packages("GGally")`)


### 3.2 相关性检验 (`cor.test`)

**任务:** 

1. 使用 `cor.test()` 对 `displ` 和 `hwy` 之间的 **Pearson** 相关性进行显著性检验。
2. 解读检验结果：相关系数估计值、P 值、置信区间。根据 P 值和 $\alpha = 0.05$ 判断相关性是否显著。
3. 使用 `cor.test()` 对 `displ` 和 `hwy` 之间的 **Spearman** 相关性进行显著性检验。
4. 解读检验结果。



### 3.3 相关不等于因果讨论

**思考题:** 假设你发现一个城市中冰淇淋销量 (`ice_cream_sales`) 与犯罪率 (`crime_rate`) 之间存在强正相关 ($r \approx 0.8, p < 0.001$)。 

1. 这是否意味着吃冰淇淋会导致犯罪？为什么？
2. 你能想到一个可能的**混淆变量**来解释这种相关性吗？
3. 如果想研究冰淇淋是否真的影响犯罪率（虽然听起来很荒谬），相关分析足够吗？需要什么样的研究设计？

## 4. 简单线性回归 (SLR) 练习

**场景:** 我们想建立一个模型，用汽车重量 `wt` (单位：1000 lbs) 来预测其每加仑英里数 `mpg` (使用 `mtcars` 数据集)。

**任务:**

1. 绘制 `wt` (x 轴) 和 `mpg` (y 轴) 的散点图，并添加线性拟合线 (`geom_smooth(method = "lm")`)。初步判断两者是否存在线性关系。 
2. 使用 `lm()` 函数拟合一个简单线性回归模型，用 `wt` 预测 `mpg`。将模型存储在 `slr_mpg_wt` 中。 
3. 使用 `summary()` 查看模型 `slr_mpg_wt` 的详细结果。 
4. **解读模型结果:** 
    - 写出回归方程 ($\hat{mpg} = \hat{\beta}_0 + \hat{\beta}_1 \times wt$)。 
    - 解释**截距**$\hat{\beta}_0$的含义（在这个场景下是否有实际意义？）。 
    - 解释**斜率**$\hat{\beta}_1$的含义。 
    - `wt` 对 `mpg` 的影响是否**统计显著**？依据是什么 (P 值)？ 
    - 模型解释了 `mpg` 变异的**百分之多少** (R-squared)？这个模型的拟合优度如何？


## 5. (可选) 预测

使用我们拟合的模型 `slr_mpg_wt` 来进行预测。

**任务:**

1. 预测一辆重量为 2500 lbs (即 `wt = 2.5`) 的汽车的 MPG。
2. 预测一辆重量为 4000 lbs (即 `wt = 4.0`) 的汽车的 MPG。
3. 使用 `predict()` 函数进行预测，并可以获取预测值的置信区间或预测区间。


## 6. 实验总结

在本实验中，我们练习了相关分析和简单线性回归。我们计算并检验了 Pearson 和 Spearman 相关系数，强调了相关不等于因果。我们使用 `ggplot2` 可视化了变量间的关系。最重要的是，我们使用 `lm()` 拟合了简单线性回归模型，并详细解读了 `summary()` 输出中的系数、P 值和 R²，理解了它们在描述变量关系和模型拟合优度方面的含义。我们还初步尝试了使用拟合的模型进行预测。