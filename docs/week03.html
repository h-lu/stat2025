<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>第三周：描述性统计：数据探索与可视化 – 统计学与R语言</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./week04.html" rel="next">
<link href="./week02.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week01.html">课程内容</a></li><li class="breadcrumb-item"><a href="./week03.html"><span class="chapter-title">第三周：描述性统计：数据探索与可视化</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">统计学与R语言</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">欢迎</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllbus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">课程概述</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">课程内容</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第一周：项目启动与统计学导论</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week02.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第二周：R语言数据导入与常用数据包</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week03.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">第三周：描述性统计：数据探索与可视化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week04.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">统计学讲义 - 第四周：推断性统计初步：参数估计与假设检验</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#用数据讲故事描述性统计与可视化" id="toc-用数据讲故事描述性统计与可视化" class="nav-link active" data-scroll-target="#用数据讲故事描述性统计与可视化">用数据讲故事：描述性统计与可视化</a></li>
  <li><a href="#描述性统计核心概念回顾与拓展" id="toc-描述性统计核心概念回顾与拓展" class="nav-link" data-scroll-target="#描述性统计核心概念回顾与拓展">1. 描述性统计核心概念回顾与拓展</a></li>
  <li><a href="#dplyr-数据清洗和预处理进阶" id="toc-dplyr-数据清洗和预处理进阶" class="nav-link" data-scroll-target="#dplyr-数据清洗和预处理进阶">2. <code>dplyr</code> 数据清洗和预处理进阶</a></li>
  <li><a href="#tidyr-数据整理数据变形" id="toc-tidyr-数据整理数据变形" class="nav-link" data-scroll-target="#tidyr-数据整理数据变形">3. <code>tidyr</code> 数据整理：数据变形</a></li>
  <li><a href="#ggplot2-数据可视化初步常用图表" id="toc-ggplot2-数据可视化初步常用图表" class="nav-link" data-scroll-target="#ggplot2-数据可视化初步常用图表">4. <code>ggplot2</code> 数据可视化初步：常用图表</a></li>
  <li><a href="#tidyverse-生态综合应用数据处理与可视化流程" id="toc-tidyverse-生态综合应用数据处理与可视化流程" class="nav-link" data-scroll-target="#tidyverse-生态综合应用数据处理与可视化流程">5. <code>tidyverse</code> 生态综合应用：数据处理与可视化流程</a></li>
  <li><a href="#本周内容总结与下周预告" id="toc-本周内容总结与下周预告" class="nav-link" data-scroll-target="#本周内容总结与下周预告">6. 本周内容总结与下周预告</a></li>
  <li><a href="#课后任务" id="toc-课后任务" class="nav-link" data-scroll-target="#课后任务">7. 课后任务</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week01.html">课程内容</a></li><li class="breadcrumb-item"><a href="./week03.html"><span class="chapter-title">第三周：描述性统计：数据探索与可视化</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">第三周：描述性统计：数据探索与可视化</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="用数据讲故事描述性统计与可视化" class="level3">
<h3 class="anchored" data-anchor-id="用数据讲故事描述性统计与可视化">用数据讲故事：描述性统计与可视化</h3>
<p>前两周我们学习了统计学基本概念、R 语言入门、数据获取和数据导入。 从本周开始，我们将进入数据分析的核心环节：<strong>描述性统计</strong>。 描述性统计是数据分析的第一步，也是至关重要的一步。 通过描述性统计，我们可以<strong>探索数据的基本特征、发现数据中的模式和规律、为后续的推断性统计分析奠定基础</strong>。 本周我们将学习使用 <code>dplyr</code> 和 <code>tidyr</code> 包进行<strong>数据清洗和预处理</strong>的进阶操作，并学习使用强大的 <code>ggplot2</code> 包进行<strong>数据可视化</strong>，将数据转化为直观、易懂的图表，用数据讲故事！</p>
<p><strong>继续使用 VS Code 或 Cursor + AI 插件：</strong> 请继续使用 VS Code 或 Cursor 编辑器，并充分利用 AI 插件的代码辅助、智能提示、聊天问答等功能，提升学习效率。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
本周学习目标
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>描述性统计核心概念:</strong> 理解描述性统计的目的和常用方法。</li>
<li><strong><code>dplyr</code> 数据清洗进阶:</strong> 掌握 <code>dplyr</code> 包更高级的数据清洗和预处理技巧。</li>
<li><strong><code>tidyr</code> 数据整理:</strong> 学习使用 <code>tidyr</code> 包进行数据整理，转换数据结构。</li>
<li><strong><code>ggplot2</code> 数据可视化入门:</strong> 掌握 <code>ggplot2</code> 包的基本语法，绘制常用统计图表 (直方图、散点图、箱线图等)。</li>
<li><strong><code>tidyverse</code> 综合应用:</strong> 学习 <code>tidyverse</code> 生态的数据处理和可视化流程。</li>
<li><strong>数据探索实践:</strong> 使用 R 和 <code>tidyverse</code> 工具，对实际数据集进行数据探索和可视化分析。</li>
<li><strong>AI 辅助数据分析:</strong> 继续探索使用 AI 工具辅助数据清洗、预处理和可视化。</li>
</ul>
</div>
</div>
<hr>
</section>
<section id="描述性统计核心概念回顾与拓展" class="level3">
<h3 class="anchored" data-anchor-id="描述性统计核心概念回顾与拓展">1. 描述性统计核心概念回顾与拓展</h3>
<ul>
<li><p><strong>描述性统计的目的:</strong></p>
<ul>
<li><strong>概括数据特征:</strong> 用简洁的数值或图表，描述数据集的<strong>中心趋势</strong> (均值、中位数、众数)、<strong>离散程度</strong> (标准差、方差、四分位距)、<strong>分布形状</strong> (偏度、峰度) 等特征。</li>
<li><strong>发现数据模式:</strong> 通过统计图表，<strong>直观地展示数据分布、变量关系、群体差异</strong> 等模式和规律。</li>
<li><strong>数据质量评估:</strong> 检查数据中是否存在<strong>异常值、缺失值、错误值</strong> 等问题，评估数据质量。</li>
<li><strong>为推断性统计做准备:</strong> 描述性统计的结果可以帮助我们<strong>选择合适的推断性统计方法、提出研究假设</strong>。</li>
</ul></li>
<li><p><strong>常用描述性统计量:</strong></p>
<ul>
<li><strong>中心趋势:</strong>
<ul>
<li><strong>均值 (Mean):</strong> 所有数据的平均值，对异常值敏感。 R 函数: <code>mean()</code></li>
<li><strong>中位数 (Median):</strong> 将数据排序后，位于中间位置的值，对异常值不敏感。 R 函数: <code>median()</code></li>
<li><strong>众数 (Mode):</strong> 数据集中出现次数最多的值。 R 中没有直接计算众数的函数，可以自定义函数或使用 <code>table()</code> 和 <code>sort()</code> 函数组合计算。</li>
</ul></li>
<li><strong>离散程度:</strong>
<ul>
<li><strong>标准差 (Standard Deviation):</strong> 度量数据分散程度的常用指标，反映数据值偏离均值的平均程度。 R 函数: <code>sd()</code></li>
<li><strong>方差 (Variance):</strong> 标准差的平方。 R 函数: <code>var()</code></li>
<li><strong>四分位距 (Interquartile Range, IQR):</strong> 第三四分位数 (Q3) 与第一四分位数 (Q1) 之差，反映中间 50% 数据的离散程度，对异常值不敏感。 R 函数: <code>IQR()</code></li>
<li><strong>极差 (Range):</strong> 最大值与最小值之差，对异常值非常敏感。 R 函数: <code>range()</code> (返回最小值和最大值), <code>diff(range())</code> 计算极差。</li>
</ul></li>
<li><strong>分布形状:</strong>
<ul>
<li><strong>偏度 (Skewness):</strong> 描述数据分布的对称性。 偏度 &gt; 0 为右偏 (正偏)，偏度 &lt; 0 为左偏 (负偏)，偏度 ≈ 0 为对称分布。 R 中 <code>e1071</code> 包的 <code>skewness()</code> 函数可以计算偏度。</li>
<li><strong>峰度 (Kurtosis):</strong> 描述数据分布的尖峭程度。 峰度 &gt; 3 为尖峰分布，峰度 &lt; 3 为平峰分布，峰度 ≈ 3 为正态分布 (峰度为 3)。 R 中 <code>e1071</code> 包的 <code>kurtosis()</code> 函数可以计算峰度。</li>
</ul></li>
</ul></li>
<li><p><strong>常用描述性统计图表:</strong></p>
<ul>
<li><strong>直方图 (Histogram):</strong> 展示数值型变量的<strong>分布</strong>情况，X 轴表示数值范围，Y 轴表示频数或频率。 <code>ggplot2</code> 函数: <code>geom_histogram()</code></li>
<li><strong>箱线图 (Boxplot):</strong> 展示数值型变量的<strong>分布、中位数、四分位数、异常值</strong> 等信息，方便比较不同组别的数据分布。 <code>ggplot2</code> 函数: <code>geom_boxplot()</code></li>
<li><strong>散点图 (Scatter Plot):</strong> 展示两个数值型变量之间的<strong>关系</strong>，X 轴和 Y 轴分别表示两个变量，每个点代表一个观测值。 <code>ggplot2</code> 函数: <code>geom_point()</code></li>
<li><strong>条形图 (Bar Chart):</strong> 展示<strong>分类变量</strong>的<strong>频数或频率</strong>，X 轴表示分类，Y 轴表示计数或比例。 <code>ggplot2</code> 函数: <code>geom_bar()</code> 或 <code>geom_col()</code> (当 Y 轴数据已汇总时使用 <code>geom_col()</code>)</li>
<li><strong>饼图 (Pie Chart):</strong> 展示<strong>分类变量</strong>的<strong>占比</strong>，不推荐过度使用，条形图通常更清晰。 <code>ggplot2</code> 中绘制饼图较为复杂，可以使用其他包或方法。</li>
<li><strong>折线图 (Line Chart):</strong> 展示<strong>时间序列数据</strong>的<strong>趋势</strong>，X 轴通常表示时间，Y 轴表示数值。 <code>ggplot2</code> 函数: <code>geom_line()</code></li>
</ul></li>
<li><p><strong>选择合适的描述性统计方法:</strong> 根据<strong>变量类型</strong>和<strong>分析目的</strong>选择合适的描述性统计方法。</p>
<ul>
<li><strong>数值型变量:</strong> 常用均值、中位数、标准差、方差、四分位距、直方图、箱线图、散点图等。</li>
<li><strong>分类变量:</strong> 常用频数、频率、百分比、条形图、饼图等。</li>
<li><strong>探索变量关系:</strong> 常用散点图、相关系数 (数值型变量之间), 分组箱线图/条形图 (分类变量与数值型变量之间), 交叉表 (分类变量之间)。</li>
<li><strong>数据质量评估:</strong> 常用缺失值统计、异常值检测 (箱线图、散点图)、描述性统计量 (检查数据范围和分布是否合理)。</li>
</ul></li>
</ul>
</section>
<section id="dplyr-数据清洗和预处理进阶" class="level3">
<h3 class="anchored" data-anchor-id="dplyr-数据清洗和预处理进阶">2. <code>dplyr</code> 数据清洗和预处理进阶</h3>
<ul>
<li><p><strong>回顾 <code>dplyr</code> 基础:</strong> 回顾上周学习的 <code>dplyr</code> 基础 “动词”： <code>filter()</code>, <code>select()</code>, <code>mutate()</code>, <code>arrange()</code>, <code>summarize()</code>, <code>group_by()</code>, <code>%&gt;%</code> 管道操作符。</p></li>
<li><p><strong><code>dplyr</code> 数据清洗常用技巧:</strong></p>
<ul>
<li><strong>处理缺失值:</strong>
<ul>
<li><strong><code>filter(!is.na(列名))</code>:</strong> 删除包含缺失值的行。 <code>!is.na()</code> 返回逻辑值，<code>TRUE</code> 表示非缺失值，<code>FALSE</code> 表示缺失值，<code>!</code> 表示取反。</li>
<li><strong><code>mutate(新列名 = ifelse(is.na(列名), 替换值, 列名))</code>:</strong> 用指定值 (例如，均值、中位数、0、特定值) 替换缺失值。 <code>ifelse()</code> 函数是条件赋值函数，<code>ifelse(条件, 真值, 假值)</code>。</li>
<li><strong><code>tidyr::replace_na(list(列名 = 替换值))</code>:</strong> 使用 <code>tidyr</code> 包的 <code>replace_na()</code> 函数替换缺失值，语法更简洁。</li>
</ul></li>
<li><strong>处理重复值:</strong>
<ul>
<li><strong><code>distinct()</code>:</strong> 删除完全重复的行。</li>
<li><strong><code>distinct(列名1, 列名2, ...)</code>:</strong> 根据指定的列组合删除重复行，保留第一次出现的行。</li>
<li><strong><code>duplicated()</code>:</strong> 检测重复值，返回逻辑向量，<code>TRUE</code> 表示重复值，<code>FALSE</code> 表示非重复值。 常与 <code>filter()</code> 函数结合使用，筛选或删除重复值。</li>
</ul></li>
<li><strong>处理异常值:</strong>
<ul>
<li><strong>箱线图可视化:</strong> 使用箱线图识别可能的异常值 (超出箱线图 “须” 的点)。</li>
<li><strong>基于标准差的方法:</strong> 例如，将超出均值 ± 3 倍标准差范围的值视为异常值。</li>
<li><strong>基于 IQR 的方法:</strong> 例如，将小于 Q1 - 1.5 * IQR 或大于 Q3 + 1.5 * IQR 的值视为异常值 (箱线图的 “须” 的计算方法)。</li>
<li><strong>根据业务知识判断:</strong> 结合实际业务背景和数据含义，判断哪些值是合理的，哪些值可能是异常的。</li>
<li><strong>处理异常值的方法:</strong> 删除异常值、替换为缺失值、替换为合理值 (例如，均值、 Winsorize 处理)、保留异常值 (如果异常值本身包含重要信息)。</li>
</ul></li>
<li><strong>数据类型转换:</strong>
<ul>
<li><strong><code>mutate(列名 = as.类型(列名))</code>:</strong> 使用 <code>as.类型()</code> 函数转换列的数据类型。 例如，<code>as.character()</code>, <code>as.numeric()</code>, <code>as.integer()</code>, <code>as.logical()</code>, <code>as.factor()</code>, <code>as.Date()</code>, <code>as.POSIXct()</code> 等。</li>
<li><strong><code>readr::parse_类型(列名)</code>:</strong> 使用 <code>readr</code> 包的 <code>parse_类型()</code> 函数进行类型转换，更严格和规范。 例如，<code>parse_character()</code>, <code>parse_double()</code>, <code>parse_integer()</code>, <code>parse_logical()</code>, <code>parse_factor()</code>, <code>parse_date()</code>, <code>parse_datetime()</code>, <code>parse_time()</code>, <code>parse_number()</code>, <code>parse_currency()</code>。</li>
<li><strong>字符数据处理:</strong>
<ul>
<li><p><strong><code>stringr</code> 包:</strong> <code>tidyverse</code> 的 <code>stringr</code> 包专门用于字符数据处理，提供了丰富的字符串操作函数，例如，字符串拼接、分割、提取、替换、大小写转换、去除空格、模式匹配 (正则表达式) 等。 常用的 <code>stringr</code> 函数包括： <code>str_c()</code>, <code>str_split()</code>, <code>str_sub()</code>, <code>str_replace()</code>, <code>str_to_lower()</code>, <code>str_to_upper()</code>, <code>str_trim()</code>, <code>str_detect()</code>, <code>str_extract()</code>, <code>str_match()</code> 等。</p></li>
<li><p><strong>示例:</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"  John Doe  "</span>, <span class="st">"Jane Smith"</span>, <span class="st">"Peter-Pan "</span>, <span class="st">"Alice_Wonderland"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">city_state =</span> <span class="fu">c</span>(<span class="st">"New York, NY"</span>, <span class="st">"Los Angeles, CA"</span>, <span class="st">"London, UK"</span>, <span class="st">"Paris, FR"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_trimmed =</span> <span class="fu">str_trim</span>(name),  <span class="co"># 去除姓名两端空格</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_upper =</span> <span class="fu">str_to_upper</span>(name_trimmed),  <span class="co"># 姓名转换为大写</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_name =</span> <span class="fu">str_split_fixed</span>(name_trimmed, <span class="st">" "</span>, <span class="at">n =</span> <span class="dv">2</span>)[, <span class="dv">1</span>],  <span class="co"># 提取 first name</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_name =</span> <span class="fu">str_split_fixed</span>(name_trimmed, <span class="st">" "</span>, <span class="at">n =</span> <span class="dv">2</span>)[, <span class="dv">2</span>],  <span class="co"># 提取 last name</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> <span class="fu">str_split_fixed</span>(city_state, <span class="st">", "</span>, <span class="at">n =</span> <span class="dv">2</span>)[, <span class="dv">1</span>],  <span class="co"># 提取城市</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_country =</span> <span class="fu">str_split_fixed</span>(city_state, <span class="st">", "</span>, <span class="at">n =</span> <span class="dv">2</span>)[, <span class="dv">2</span>]  <span class="co"># 提取州/国家</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name, <span class="sc">-</span>city_state)  <span class="co"># 删除原始列</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cleaned_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul></li>
</ul></li>
<li><p><strong><code>dplyr</code> 进阶操作:</strong></p>
<ul>
<li><strong>条件型数据转换 (<code>case_when()</code>):</strong> <code>case_when()</code> 函数可以根据多个条件进行赋值，类似于 <code>if-else if-else</code> 结构，但语法更简洁，可读性更高。 <code>r     data_with_category &lt;- data %&gt;%       mutate(         category = case_when(           value &lt; 10 ~ "Low",           value &gt;= 10 &amp; value &lt; 50 ~ "Medium",           value &gt;= 50 ~ "High",           TRUE ~ "Unknown"  # 默认情况，类似于 else         )       )</code></li>
<li><strong>窗口函数 (<code>window functions</code>):</strong> 窗口函数可以在分组数据上进行计算，例如，计算每个分组内的排名、累计值、移动平均值等。 <code>dplyr</code> 提供了 <code>row_number()</code>, <code>rank()</code>, <code>dense_rank()</code>, <code>percent_rank()</code>, <code>lead()</code>, <code>lag()</code>, <code>cumsum()</code>, <code>cummean()</code>, <code>cummax()</code>, <code>cummin()</code> 等窗口函数。 窗口函数通常与 <code>group_by()</code> 和 <code>mutate()</code> 函数结合使用。 <code>r     data_with_rank &lt;- data %&gt;%       group_by(group_col) %&gt;%       mutate(         rank_within_group = rank(value),  # 计算组内排名         cumulative_sum = cumsum(value)  # 计算组内累计和       ) %&gt;%       ungroup()  # 取消分组，后续操作不再分组</code></li>
</ul></li>
<li><p><strong><code>dplyr</code> 数据清洗练习:</strong> 使用 <code>flights</code> 数据集或其他数据集，练习使用 <code>dplyr</code> 进行数据清洗和预处理，例如：</p>
<ul>
<li>处理 <code>flights</code> 数据集中的缺失值 (例如，<code>dep_delay</code>, <code>arr_delay</code>, <code>air_time</code> 等列可能存在缺失值)。</li>
<li>检测和处理 <code>flights</code> 数据集中的异常值 (例如，<code>dep_delay</code>, <code>arr_delay</code>, <code>distance</code> 等列可能存在异常值)。</li>
<li>将 <code>flights</code> 数据集中的航空公司代码 <code>carrier</code> 转换为航空公司名称 (可以使用 <code>航空公司代码-名称</code> 对照表，进行 join 操作，下周学习 join)。</li>
<li>使用 <code>stringr</code> 包处理 <code>flights</code> 数据集中的字符型数据 (如果存在)。</li>
<li>使用 <code>case_when()</code> 函数创建新的分类变量 (例如，根据 <code>dep_delay</code> 将航班分为 “准点”, “轻微延误”, “严重延误” 等类别)。</li>
<li>使用窗口函数计算每个航空公司的航班数量排名、平均延误时间排名等。</li>
</ul></li>
</ul>
</section>
<section id="tidyr-数据整理数据变形" class="level3">
<h3 class="anchored" data-anchor-id="tidyr-数据整理数据变形">3. <code>tidyr</code> 数据整理：数据变形</h3>
<ul>
<li><p><strong><code>tidyr</code> 包的目的:</strong> <code>tidyr</code> 包是 <code>tidyverse</code> 生态中专门用于<strong>数据整理 (data tidying)</strong> 的包。 数据整理的目标是将数据转换为<strong>整洁数据 (tidy data)</strong> 格式，方便后续的数据分析和可视化。 <strong>整洁数据</strong> 的核心原则是：</p>
<ul>
<li><strong>每个变量占一列 (Each variable forms a column).</strong></li>
<li><strong>每个观测值占一行 (Each observation forms a row).</strong></li>
<li><strong>每个值自成一个单元格 (Each value forms a cell).</strong></li>
</ul></li>
<li><p><strong><code>tidyr</code> 数据变形常用函数:</strong></p>
<ul>
<li><p><strong><code>pivot_longer()</code> (长数据透视):</strong> 将<strong>宽格式 (wide format)</strong> 数据转换为<strong>长格式 (long format)</strong> 数据。 宽格式数据中，一个观测值的多个变量可能分布在多列中，长格式数据则将这些变量 “堆叠” 成一列，并使用另一列标识变量名。 <code>pivot_longer()</code> 函数可以将指定的<strong>多列</strong> “透视” 成<strong>两列</strong>：<strong>变量名列 (name column)</strong> 和 <strong>值列 (value column)</strong>。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 宽格式数据示例</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">var1_2020 =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">15</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var2_2020 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">var1_2021 =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">16</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">var2_2021 =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">27</span>, <span class="dv">33</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 pivot_longer() 转换为长格式</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"var"</span>),  <span class="co"># 指定要透视的列，使用 starts_with() 选择以 "var" 开头的列</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"year"</span>),  <span class="co"># 指定变量名列和年份列的名称</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"_"</span>,  <span class="co"># 指定列名分隔符 "_"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span>  <span class="co"># 指定值列的名称</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(long_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>cols</code> 参数:</strong> 指定要透视的列。 可以使用列名向量、列索引向量、列名选择函数 (例如 <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code>, <code>matches()</code>, <code>num_range()</code>, <code>everything()</code>, <code>last_col()</code>) 等。</li>
<li><strong><code>names_to</code> 参数:</strong> 指定透视后的变量名列的名称。 可以传入一个字符向量，指定变量名列的名称，如果 <code>names_sep</code> 或 <code>names_pattern</code> 参数被使用，则 <code>names_to</code> 可以传入多个名称，表示将列名拆分成多列。</li>
<li><strong><code>names_sep</code> 参数:</strong> 指定列名分隔符。 如果列名包含多个信息，可以使用分隔符将列名拆分成多列。</li>
<li><strong><code>names_pattern</code> 参数:</strong> 使用正则表达式匹配列名，并将匹配到的部分拆分成多列。 <code>names_sep</code> 和 <code>names_pattern</code> 只能使用一个。</li>
<li><strong><code>values_to</code> 参数:</strong> 指定透视后的值列的名称。</li>
</ul></li>
<li><p><strong><code>pivot_wider()</code> (宽数据透视):</strong> 将<strong>长格式 (long format)</strong> 数据转换为<strong>宽格式 (wide format)</strong> 数据。 <code>pivot_wider()</code> 是 <code>pivot_longer()</code> 的逆操作。 <code>pivot_wider()</code> 函数需要指定<strong>哪一列作为新的列名 (names_from)</strong>，<strong>哪一列作为新的值 (values_from)</strong>。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 长格式数据示例 (上例中的 long_data)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"var1"</span>, <span class="st">"var2"</span>), <span class="at">each =</span> <span class="dv">2</span>, <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"2020"</span>, <span class="st">"2021"</span>), <span class="at">each =</span> <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">6</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">12</span>, <span class="dv">25</span>, <span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">11</span>, <span class="dv">22</span>, <span class="dv">13</span>, <span class="dv">27</span>, <span class="dv">16</span>, <span class="dv">33</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 pivot_wider() 转换为宽格式</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>wide_data_reconstructed <span class="ot">&lt;-</span> long_data <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"year"</span>),  <span class="co"># 指定列名来源列，这里使用 variable 和 year 两列组合作为新列名</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"value"</span>  <span class="co"># 指定值来源列</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(wide_data_reconstructed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>names_from</code> 参数:</strong> 指定列名来源列。 可以使用列名向量，指定一列或多列作为新列名的来源。 如果指定多列，则新列名将由这些列的值组合而成。</li>
<li><strong><code>values_from</code> 参数:</strong> 指定值来源列。 可以使用列名向量，指定一列或多列作为新值的来源。 如果 <code>names_from</code> 指定了多列，<code>values_from</code> 也应该指定相同数量的列，或者只指定一列，表示所有新列的值都来自同一列。</li>
</ul></li>
<li><p><strong><code>separate()</code> (列分割):</strong> 将<strong>一列</strong>按照指定的分隔符分割成<strong>多列</strong>。 <code>separate()</code> 函数类似于 <code>stringr::str_split_fixed()</code> 函数，但 <code>separate()</code> 直接操作数据框列，更方便。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_with_combined_col <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">combined_col =</span> <span class="fu">c</span>(<span class="st">"A-1"</span>, <span class="st">"B-2"</span>, <span class="st">"C-3"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>separated_data <span class="ot">&lt;-</span> data_with_combined_col <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> combined_col,  <span class="co"># 指定要分割的列</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"col1"</span>, <span class="st">"col2"</span>),  <span class="co"># 指定分割后的新列名</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"-"</span>  <span class="co"># 指定分隔符 "-"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(separated_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>col</code> 参数:</strong> 指定要分割的列名。</li>
<li><strong><code>into</code> 参数:</strong> 指定分割后的新列名。 传入一个字符向量，指定新列的名称。</li>
<li><strong><code>sep</code> 参数:</strong> 指定分隔符。 可以使用字符或正则表达式作为分隔符。</li>
</ul></li>
<li><p><strong><code>unite()</code> (列合并):</strong> 将<strong>多列</strong>合并成<strong>一列</strong>，并使用指定的分隔符连接。 <code>unite()</code> 是 <code>separate()</code> 的逆操作。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>separated_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">col1 =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col2 =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>united_data <span class="ot">&lt;-</span> separated_data <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> combined_col,  <span class="co"># 指定合并后的新列名</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    col1, col2,  <span class="co"># 指定要合并的列</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"-"</span>  <span class="co"># 指定分隔符 "-"</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(united_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>col</code> 参数:</strong> 指定合并后的新列名。</li>
<li><strong><code>...</code> 参数:</strong> 使用 <code>...</code> 传入要合并的列名，可以传入多个列名。</li>
<li><strong><code>sep</code> 参数:</strong> 指定分隔符。</li>
</ul></li>
</ul></li>
<li><p><strong><code>tidyr</code> 数据整理练习:</strong> 使用 <code>flights</code> 数据集或其他数据集，练习使用 <code>tidyr</code> 进行数据整理，例如：</p>
<ul>
<li>将 <code>flights</code> 数据集转换为长格式，例如，将 <code>dep_delay</code> 和 <code>arr_delay</code> 两列透视为一列 <code>delay_type</code> (取值为 “dep_delay” 或 “arr_delay”) 和一列 <code>delay_time</code> (延误时间)。</li>
<li>将宽格式的数据 (例如，包含多年份数据的表格) 转换为长格式，方便进行时间序列分析或面板数据分析。</li>
<li>分割包含复合信息的列，例如，将日期时间列分割成日期列和时间列，将地址列分割成城市列、州列、国家列等。</li>
<li>合并多列信息，例如，将年、月、日列合并成日期列，将姓、名列合并成姓名列。</li>
</ul></li>
</ul>
</section>
<section id="ggplot2-数据可视化初步常用图表" class="level3">
<h3 class="anchored" data-anchor-id="ggplot2-数据可视化初步常用图表">4. <code>ggplot2</code> 数据可视化初步：常用图表</h3>
<ul>
<li><p><strong><code>ggplot2</code> 包简介:</strong> <code>ggplot2</code> 包是 R 语言中最强大、最灵活、最流行的<strong>数据可视化</strong>包，也是 <code>tidyverse</code> 生态的核心包之一。 <code>ggplot2</code> 基于<strong>图层语法 (grammar of graphics)</strong>，将数据可视化分解为多个独立的图层，用户可以灵活组合这些图层，创建各种复杂的统计图表。 <code>ggplot2</code> 的特点包括：</p>
<ul>
<li><strong>图层语法:</strong> 基于图层语法，灵活、强大、可扩展。</li>
<li><strong>美观的默认样式:</strong> 默认生成的图表美观、专业。</li>
<li><strong>高度定制化:</strong> 可以高度定制图表的各个方面，例如，颜色、形状、大小、标签、标题、主题等。</li>
<li><strong>与 <code>tidyverse</code> 完美集成:</strong> 与 <code>dplyr</code>, <code>tidyr</code> 等 <code>tidyverse</code> 包无缝衔接，数据处理和可视化流程流畅。</li>
</ul></li>
<li><p><strong><code>ggplot2</code> 基本语法:</strong> <code>ggplot2</code> 绘图的基本流程是：</p>
<ol type="1">
<li><strong>创建 <code>ggplot</code> 对象:</strong> 使用 <code>ggplot()</code> 函数创建 <code>ggplot</code> 对象，并指定<strong>数据 (data)</strong> 和<strong>映射 (mapping, <code>aes()</code>)</strong>。 <code>data</code> 参数指定要使用的数据框，<code>mapping</code> 参数使用 <code>aes()</code> 函数指定<strong>变量</strong>如何<strong>映射</strong>到<strong>图形属性 (aesthetics)</strong>，例如，X 轴、Y 轴、颜色、形状、大小、填充等。</li>
<li><strong>添加几何对象 (geometric objects, <code>geom_xxx()</code>):</strong> 使用各种 <code>geom_xxx()</code> 函数添加<strong>几何对象</strong>图层，例如，<code>geom_point()</code> (散点图), <code>geom_line()</code> (折线图), <code>geom_bar()</code> (条形图), <code>geom_histogram()</code> (直方图), <code>geom_boxplot()</code> (箱线图) 等。 每个 <code>geom_xxx()</code> 函数都对应一种图表类型。 几何对象图层决定了图表的<strong>类型</strong>和<strong>基本形状</strong>。</li>
<li><strong>添加统计变换 (statistical transformations, <code>stat_xxx()</code>):</strong> 某些几何对象需要进行<strong>统计变换</strong>，例如，直方图需要计算频数，条形图需要计算汇总统计量。 <code>ggplot2</code> 会自动进行默认的统计变换，用户也可以使用 <code>stat_xxx()</code> 函数手动指定统计变换。 通常情况下，无需手动添加统计变换图层。</li>
<li><strong>添加标度 (scales, <code>scale_xxx_yyy()</code>):</strong> 标度控制<strong>数据值</strong>到<strong>图形属性</strong>的<strong>映射方式</strong>，例如，X 轴和 Y 轴的刻度范围、颜色标度、形状标度、大小标度等。 <code>ggplot2</code> 会自动使用默认标度，用户可以使用 <code>scale_xxx_yyy()</code> 函数自定义标度，例如，<code>scale_x_continuous()</code>, <code>scale_y_continuous()</code>, <code>scale_color_manual()</code>, <code>scale_shape_manual()</code>, <code>scale_size_continuous()</code> 等。</li>
<li><strong>添加坐标系 (coordinate systems, <code>coord_xxx()</code>):</strong> 坐标系控制图表的<strong>坐标轴类型</strong>和<strong>方向</strong>，例如，笛卡尔坐标系 (默认), 极坐标系, 地理坐标系等。 <code>ggplot2</code> 默认使用笛卡尔坐标系，用户可以使用 <code>coord_xxx()</code> 函数自定义坐标系，例如，<code>coord_cartesian()</code>, <code>coord_polar()</code>, <code>coord_map()</code> 等。</li>
<li><strong>添加分面 (faceting, <code>facet_xxx()</code>):</strong> 分面可以将图表<strong>分割成多个子图</strong>，按照一个或多个分类变量进行分组，方便比较不同组别的数据。 <code>ggplot2</code> 提供了 <code>facet_wrap()</code> (单变量分面) 和 <code>facet_grid()</code> (双变量分面) 函数。</li>
<li><strong>添加主题 (themes, <code>theme()</code>):</strong> 主题控制图表的<strong>整体外观样式</strong>，例如，背景颜色、网格线、字体、标题位置、图例样式等。 <code>ggplot2</code> 提供了多种内置主题 (例如 <code>theme_bw()</code>, <code>theme_minimal()</code>, <code>theme_classic()</code>)，用户也可以使用 <code>theme()</code> 函数自定义主题。</li>
<li><strong>添加标签、标题等 (labels, titles, etc., <code>labs()</code>, <code>ggtitle()</code>, <code>xlab()</code>, <code>ylab()</code>, <code>caption()</code>):</strong> 使用 <code>labs()</code> 函数添加<strong>标签</strong> (例如，X 轴标签、Y 轴标签、颜色图例标签、形状图例标签等), 使用 <code>ggtitle()</code> 函数添加<strong>主标题</strong>, 使用 <code>xlab()</code> 和 <code>ylab()</code> 函数分别添加 X 轴和 Y 轴标签, 使用 <code>caption()</code> 函数添加<strong>图表脚注</strong>。</li>
</ol></li>
<li><p><strong>常用 <code>ggplot2</code> 图表类型示例 (使用 <code>flights</code> 数据集):</strong></p>
<ul>
<li><p><strong>直方图 (Histogram):</strong> 展示 <code>dep_delay</code> 出发延误时间的分布。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights, <span class="fu">aes</span>(<span class="at">x =</span> dep_delay)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">15</span>)  <span class="co"># binwidth 参数指定组距</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>ggplot(flights, aes(x = dep_delay))</code>: 创建 <code>ggplot</code> 对象，指定数据为 <code>flights</code> 数据框，X 轴映射为 <code>dep_delay</code> 变量。</li>
<li><code>geom_histogram(binwidth = 15)</code>: 添加直方图几何对象图层，<code>binwidth = 15</code> 指定组距为 15 分钟。</li>
</ul></li>
<li><p><strong>散点图 (Scatter Plot):</strong> 展示 <code>dep_delay</code> 出发延误时间与 <code>arr_delay</code> 到达延误时间的关系。 <code>r     ggplot(flights, aes(x = dep_delay, y = arr_delay)) +       geom_point()</code></p>
<ul>
<li><code>ggplot(flights, aes(x = dep_delay, y = arr_delay))</code>: 创建 <code>ggplot</code> 对象，指定 X 轴映射为 <code>dep_delay</code>，Y 轴映射为 <code>arr_delay</code>。</li>
<li><code>geom_point()</code>: 添加散点图几何对象图层。</li>
</ul></li>
<li><p><strong>箱线图 (Boxplot):</strong> 比较不同航空公司 <code>carrier</code> 的 <code>arr_delay</code> 到达延误时间分布。 <code>r     ggplot(flights, aes(x = carrier, y = arr_delay)) +       geom_boxplot()</code></p>
<ul>
<li><code>ggplot(flights, aes(x = carrier, y = arr_delay))</code>: 创建 <code>ggplot</code> 对象，指定 X 轴映射为 <code>carrier</code> (分类变量), Y 轴映射为 <code>arr_delay</code> (数值型变量)。</li>
<li><code>geom_boxplot()</code>: 添加箱线图几何对象图层。</li>
</ul></li>
<li><p><strong>条形图 (Bar Chart):</strong> 展示不同航空公司 <code>carrier</code> 的航班数量。 <code>r     ggplot(flights, aes(x = carrier)) +       geom_bar()</code></p>
<ul>
<li><code>ggplot(flights, aes(x = carrier))</code>: 创建 <code>ggplot</code> 对象，只指定 X 轴映射为 <code>carrier</code>。 <code>geom_bar()</code> 默认统计每个分类的频数。</li>
<li><code>geom_bar()</code>: 添加条形图几何对象图层。</li>
</ul></li>
<li><p><strong>添加颜色、形状、大小等图形属性:</strong> 可以使用 <code>aes()</code> 函数在 <code>geom_xxx()</code> 函数内部或 <code>ggplot()</code> 函数内部指定额外的图形属性映射，例如，使用 <code>color</code> 映射颜色, <code>shape</code> 映射形状, <code>size</code> 映射大小, <code>fill</code> 映射填充颜色等。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 散点图，使用 color 映射航空公司 carrier</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights, <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay, <span class="at">color =</span> carrier)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 散点图，使用 size 映射飞行距离 distance</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights, <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay, <span class="at">size =</span> distance)) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>添加标题、标签、主题:</strong> <code>r     ggplot(flights, aes(x = dep_delay, y = arr_delay, color = carrier)) +       geom_point() +       labs(title = "出发延误 vs 到达延误",  # 主标题            subtitle = "按航空公司着色",  # 副标题            x = "出发延误时间 (分钟)",  # X 轴标签            y = "到达延误时间 (分钟)",  # Y 轴标签            color = "航空公司",  # 颜色图例标签            caption = "数据来源：nycflights13 包") +  # 图表脚注       theme_bw()  # 使用黑白主题</code></p></li>
</ul></li>
<li><p><strong><code>ggplot2</code> 可视化练习:</strong> 使用 <code>flights</code> 数据集或其他数据集，练习使用 <code>ggplot2</code> 绘制各种常用统计图表，并尝试自定义图表的各个方面，例如：</p>
<ul>
<li>绘制 <code>flights</code> 数据集 <code>distance</code> 飞行距离的直方图，并尝试调整 <code>binwidth</code> 参数。</li>
<li>绘制 <code>flights</code> 数据集 <code>air_time</code> 飞行时间的箱线图，按照出发机场 <code>origin</code> 分组。</li>
<li>绘制 <code>flights</code> 数据集 <code>dep_delay</code> 与 <code>arr_delay</code> 的散点图，并使用颜色或形状映射航空公司 <code>carrier</code>。</li>
<li>绘制 <code>flights</code> 数据集航空公司 <code>carrier</code> 的条形图，并添加航班数量标签。</li>
<li>尝试修改图表的标题、标签、颜色、主题等，使图表更美观、更易读。</li>
</ul></li>
</ul>
</section>
<section id="tidyverse-生态综合应用数据处理与可视化流程" class="level3">
<h3 class="anchored" data-anchor-id="tidyverse-生态综合应用数据处理与可视化流程">5. <code>tidyverse</code> 生态综合应用：数据处理与可视化流程</h3>
<ul>
<li><p><strong><code>tidyverse</code> 数据分析流程:</strong> <code>tidyverse</code> 生态提供了一套完整的数据分析流程，包括：</p>
<ol type="1">
<li><strong>数据导入 (<code>readr</code>, <code>datatable</code>):</strong> 使用 <code>readr</code> 或 <code>datatable</code> 包读取各种数据格式的文件。</li>
<li><strong>数据整理 (<code>tidyr</code>):</strong> 使用 <code>tidyr</code> 包将数据转换为整洁数据格式。</li>
<li><strong>数据清洗和预处理 (<code>dplyr</code>, <code>stringr</code>):</strong> 使用 <code>dplyr</code> 和 <code>stringr</code> 包进行数据清洗、缺失值处理、异常值处理、数据类型转换、字符数据处理等。</li>
<li><strong>数据探索和描述性统计 (<code>dplyr</code>):</strong> 使用 <code>dplyr</code> 包进行数据汇总、分组统计、计算描述性统计量。</li>
<li><strong>数据可视化 (<code>ggplot2</code>):</strong> 使用 <code>ggplot2</code> 包绘制各种统计图表，探索数据模式、展示分析结果。</li>
<li><strong>数据建模和推断性统计 (后续课程):</strong> 使用 R 的统计建模和推断性统计功能进行更深入的数据分析 (本周不涉及)。</li>
<li><strong>结果沟通和报告 (后续课程):</strong> 将数据分析结果整理成报告、幻灯片、交互式应用等形式，进行有效沟通 (本周不涉及)。</li>
</ol></li>
<li><p><strong><code>tidyverse</code> 流程示例 (使用 <code>flights</code> 数据集):</strong> 以分析不同航空公司的平均延误时间为例，演示 <code>tidyverse</code> 数据处理和可视化流程。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 数据导入 (flights 数据集已加载到 nycflights13 包中，无需额外导入)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. 数据整理 (flights 数据集已经是整洁数据格式，无需整理)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 数据清洗和预处理 (简单处理缺失值，移除到达延误时间为缺失值的航班)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>flights_cleaned <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(arr_delay))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 数据探索和描述性统计 (按照航空公司分组，计算平均到达延误时间)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>carrier_delay_summary <span class="ot">&lt;-</span> flights_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(arr_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_delay))  <span class="co"># 按照平均延误时间降序排序</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(carrier_delay_summary)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. 数据可视化 (绘制条形图，展示不同航空公司的平均到达延误时间)</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(carrier_delay_summary, <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> mean_delay)) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span>  <span class="co"># 柱形图，填充颜色为 steelblue</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(mean_delay, <span class="dv">1</span>)),  <span class="co"># 添加文本标签，显示平均延误时间，保留一位小数</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span>  <span class="co"># 标签垂直位置微调</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"不同航空公司平均到达延误时间"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"航空公司代码"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"平均到达延误时间 (分钟)"</span>) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># 使用 minimal 主题</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong><code>tidyverse</code> 综合练习:</strong> 选择一个实际数据集 (例如，<code>flights</code> 数据集、项目一的数据集或其他公开数据集)，使用 <code>tidyverse</code> 生态的 <code>readr</code>, <code>tidyr</code>, <code>dplyr</code>, <code>stringr</code>, <code>ggplot2</code> 包，完成一个完整的数据分析和可视化项目，包括数据导入、数据整理、数据清洗、数据预处理、描述性统计分析、数据可视化、结果解释和报告撰写 (报告撰写为可选，重点练习数据处理和可视化)。</p></li>
</ul>
</section>
<section id="本周内容总结与下周预告" class="level3">
<h3 class="anchored" data-anchor-id="本周内容总结与下周预告">6. 本周内容总结与下周预告</h3>
<ul>
<li><p><strong>本周回顾:</strong> 回顾本周学习内容，巩固重点知识。 本周我们<strong>深入学习</strong>了描述性统计的核心概念，<code>dplyr</code> 数据清洗和预处理进阶技巧，<code>tidyr</code> 数据整理方法，<code>ggplot2</code> 数据可视化初步，以及 <code>tidyverse</code> 生态的综合应用。 <strong>描述性统计、数据清洗、数据整理和数据可视化是数据分析的关键技能，务必熟练掌握本周所学内容。</strong></p></li>
<li><p><strong>下周预告:</strong> 下周我们将继续深入学习 <code>ggplot2</code> 包，学习更高级的数据可视化技巧，例如，多图层组合、图形精细调整、交互式图表制作等。 我们将探索更多 <code>ggplot2</code> 的几何对象、统计变换、标度、坐标系、分面、主题等，打造更专业、更精美、更具洞察力的数据可视化作品。</p></li>
</ul>
</section>
<section id="课后任务" class="level3">
<h3 class="anchored" data-anchor-id="课后任务">7. 课后任务</h3>
<ul>
<li><strong>小组任务:</strong>
<ul>
<li><strong>项目一数据清洗和预处理:</strong> 各小组根据本周学习的数据清洗和预处理方法，使用 <code>dplyr</code> 和 <code>tidyr</code> 包对项目一的数据集进行数据清洗和预处理。 完成缺失值处理、异常值处理、数据类型转换、数据整理等任务，确保数据质量和整洁性，为后续的数据分析和可视化做好准备。</li>
<li><strong>项目一数据可视化方案:</strong> 小组讨论项目一的数据可视化方案，确定要展示的数据特征和模式，选择合适的图表类型，设计图表布局和样式。</li>
</ul></li>
<li><strong>个人任务:</strong>
<ul>
<li><strong>复习本周内容:</strong> 回顾本周讲义和课堂笔记，巩固描述性统计概念、<code>dplyr</code> 数据清洗技巧、<code>tidyr</code> 数据整理方法、<code>ggplot2</code> 可视化语法和常用图表类型。</li>
<li><strong>R 代码练习:</strong> 完成本讲义中布置的 R 代码练习，熟练掌握 <code>dplyr</code>, <code>tidyr</code>, <code>stringr</code>, <code>ggplot2</code> 包的常用函数。 尝试使用 AI 插件辅助 R 代码练习。</li>
<li><strong>数据集可视化探索:</strong> 选择 <code>flights</code> 数据集或项目一的数据集，使用 <code>ggplot2</code> 包进行数据可视化探索，尝试绘制各种图表，并自定义图表样式，深入理解数据特征和模式。 可以尝试完成讲义中提供的练习题，也可以自己设计可视化探索任务。</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
AI 辅助学习小贴士
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>R 代码练习:</strong> 继续在 VS Code 或 Cursor 中练习 R 语言代码，充分利用 AI 插件的代码自动补全、代码生成、代码解释、AI 聊天等功能。 遇到 R 代码问题，及时向 AI 提问。</li>
<li><strong>数据包使用问题:</strong> 如果在使用 <code>dplyr</code>, <code>tidyr</code>, <code>stringr</code>, <code>ggplot2</code> 等数据包时遇到问题，可以查阅包的官方文档，或者使用 AI 聊天提问，寻求帮助。
<ul>
<li><strong><code>dplyr</code> 数据清洗技巧:</strong> 例如，如何使用 <code>filter()</code> 筛选满足多个条件的行？ 如何使用 <code>mutate()</code> 创建多个新列？ 如何使用 <code>group_by()</code> 和 <code>summarize()</code> 进行分组汇总统计？</li>
<li><strong><code>tidyr</code> 数据整理方法:</strong> 例如，<code>pivot_longer()</code> 和 <code>pivot_wider()</code> 函数的参数如何设置？ <code>separate()</code> 和 <code>unite()</code> 函数如何使用？ 如何将复杂格式的数据转换为整洁数据？</li>
<li><strong><code>ggplot2</code> 可视化语法:</strong> 例如，<code>ggplot()</code> 和 <code>aes()</code> 函数如何使用？ 各种 <code>geom_xxx()</code> 函数的作用是什么？ 如何添加标题、标签、主题？ 如何自定义图表样式？</li>
</ul></li>
<li><strong>统计图表选择:</strong> 如果不确定使用哪种图表类型来展示数据，可以通过AI聊天工具寻求建议。例如，可以提问：“哪种图表适合比较多个组的分布情况？” 或 “如何可视化两个数值变量之间的关系？”。AI不仅会推荐合适的图表类型，还会提供相应的<code>ggplot2</code>代码示例。</li>
<li><strong>可视化代码生成:</strong> 使用 AI 代码生成功能，输入注释，例如： <code># 使用 ggplot2 创建价格的直方图</code>, <code># 使用 ggplot2 创建 'x' 和 'y' 的散点图，并按 'category' 着色</code>, 让 AI 生成可视化代码。</li>
<li><strong>代码解释和优化:</strong> 使用 AI 代码解释功能，选中 <code>tidyverse</code> 代码片段，让 AI 解释代码的功能和每一行代码的作用。 如果代码运行效率较低，可以使用 AI 聊天咨询代码优化技巧。</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
学习寄语
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>图表胜千言！ 本周我们学习了描述性统计和数据可视化的核心技能，掌握了用数据讲故事的能力。 精美、清晰、有洞察力的图表是数据分析的灵魂！</strong> 继续保持学习的热情，充分利用 VS Code/Cursor 和 AI 插件的强大功能，相信大家会在统计学和 R 语言的学习中取得更大的进步！ 下周见！</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week02.html" class="pagination-link" aria-label="第二周：R语言数据导入与常用数据包">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">第二周：R语言数据导入与常用数据包</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./week04.html" class="pagination-link" aria-label="统计学讲义 - 第四周：推断性统计初步：参数估计与假设检验">
        <span class="nav-page-text"><span class="chapter-title">统计学讲义 - 第四周：推断性统计初步：参数估计与假设检验</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>