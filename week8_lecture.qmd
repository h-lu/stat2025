---
title: "第八周：承前启后：阶段回顾与多元回归再探"
execute:
  echo: true
  message: false
  warning: false
  error: false
  cache: false
---

## 1. 欢迎来到第二阶段！

本周我们正式进入课程的第二阶段。在深入学习更高级的统计模型之前，我们需要系统地回顾和巩固第一阶段（第 1-7 周）的核心知识，并在此基础上，重新审视和深入理解**多元线性回归 (Multiple Linear Regression, MLR)**。

::: {.callout-note title="本周目标"}
-   **系统回顾**第一阶段核心内容：数据处理与可视化 (`tidyverse`, `ggplot2`)；描述统计；参数估计（点估计与置信区间）；假设检验逻辑；常用检验方法 (t 检验, ANOVA, 卡方检验)；相关分析；简单线性回归 (SLR) 基础与多元线性回归 (MLR) 初步概念。
-   **深入理解** MLR 中**偏回归系数**的意义：控制变量与独立效应。
-   **反复练习**对 `lm()` 输出中 MLR 系数的**业务含义解释**。
-   区分统计显著性与实际重要性。
-   回顾线性回归的 **L.I.N.E.** 假设，理解其重要性及违背后果。
-   （演示）利用 AI 辅助回顾概念、解释 MLR 系数，并**强调验证其准确性**。
:::

## 2. 阶段一知识回顾 (重点环节)

让我们通过互动问答、知识点串讲和快速练习，快速回顾一下前七周的核心内容。

::: panel-tabset
### 数据处理与可视化

-   **`tidyverse` 核心包:** `dplyr`, `tidyr`, `readr`, `ggplot2` 等。
-   **`dplyr` 动词:**
    -   `select()`: 选择列。
    -   `filter()`: 筛选行。
    -   `mutate()`: 创建/修改列。
    -   `arrange()`: 排序。
    -   `group_by()` + `summarise()`: 分组汇总 (常用 `n()`, `mean()`, `sd()`, `min()`, `max()`, `n_distinct()`)。
    -   管道 `%>%`: 连接操作。
-   **`tidyr` 动词:**
    -   `pivot_longer()`: 宽数据变长。
    -   `pivot_wider()`: 长数据变宽。
    -   `drop_na()`: 删除含 NA 的行。
    -   `replace_na()`: 替换 NA。
-   **整洁数据原则:** 每个变量一列，每个观测一行，每种观测一个表。
-   **`ggplot2` 图形语法:**
    -   `ggplot(data, aes(x=..., y=..., color=...)) + geom_xxx(...)`
    -   常用 `geom`: `geom_point`, `geom_line`, `geom_histogram`, `geom_density`, `geom_boxplot`, `geom_violin`, `geom_bar`, `geom_col`, `geom_smooth`。
    -   定制: `labs()`, `theme_...()`, `coord_flip()`。

**快速练习:** 

1. 如何筛选 `mpg` 数据集中 `manufacturer` 为 "audi" 且 `year` 为 2008 的车辆？ 
2. 如何计算 `mpg` 数据集中每个 `manufacturer` 的平均城市里程 (`cty`)？ 
3. 如何用 `ggplot2` 绘制 `mpg` 数据集中 `cty` (城市里程) 与 `hwy` (高速里程) 的散点图，并按 `drv` (驱动方式) 区分颜色？


### 描述统计与参数估计

-   **描述统计:**
    -   集中趋势: 均值 (`mean`), 中位数 (`median`)。
    -   离散趋势: 标准差 (`sd`), 方差 (`var`), IQR (`IQR`), 范围 (`range`)。
-   **参数估计:**
    -   点估计: 用样本统计量估计总体参数 (如 $\bar{x}$ 估计 $\mu$)。
    -   区间估计: 置信区间 (CI)。
-   **置信区间:**
    -   提供总体参数可能范围的估计，并附带置信水平。
    -   95% CI 含义：重复抽样构造区间，约 95% 的区间会包含真值。
    -   解读：我们有 XX% 的信心认为总体参数落在 \[下限, 上限\] 之间。
    -   影响因素：置信水平、样本量、数据变异性。

**快速思考:** 

1. 什么时候应该使用中位数而不是均值来描述数据的中心？
2. 99% 置信区间与 95% 置信区间相比，哪个更宽？为什么？ 
3. 增加样本量会对置信区间的宽度产生什么影响？

### 假设检验逻辑与常用方法

-   **假设检验逻辑:**
    -   $H_0$ (原假设) vs $H_1$ (备择假设)。
    -   $\alpha$ (显著性水平，第一类错误概率)。
    -   检验统计量。
    -   P 值 (在 $H_0$ 为真的条件下，观测到当前或更极端结果的概率)。
    -   决策：P ≤ $\alpha$ -\> 拒绝 $H_0$；P \> $\alpha$ -\> 未能拒绝 $H_0$。
    -   两类错误：Type I ($\alpha$) vs Type II ($\beta$)；Power = $1-\beta$。
-   **常用检验方法回顾 (见第七周总结):**
    -   **t 检验 (`t.test`)**: 比较 1 或 2 组均值 (单样本, 双独立样本, 配对样本)。
    -   **ANOVA (`aov`, `TukeyHSD`)**: 比较 3+ 组均值。
    -   **卡方检验 (`chisq.test`, `fisher.test`)**: 分析分类变量关联性 (独立性检验) 或分布拟合 (拟合优度检验)。
    -   **相关检验 (`cor.test`)**: 检验两个连续 (或有序) 变量的相关性是否显著。
    -   **SLR (`lm`)**: 检验单个自变量对因变量的线性影响是否显著 (看系数的 P 值)。

**快速判断:** 

1. 想比较两种不同减肥方法的效果（体重减少量），应使用哪种检验？(假设满足条件) 
2. 想调查某大学男女生对食堂满意度（满意/不满意）是否存在差异，应使用哪种检验？ 
3. 想研究广告投入（连续变量）与产品销量（连续变量）之间是否存在线性关系，应使用哪种分析？ 
4. 想比较三种不同品牌灯泡的平均寿命是否有差异，应使用哪种检验？如果结果显著，下一步该做什么？
:::

## 3. 多元回归“再认识”：深入理解偏回归系数

我们在第六周初步接触了 MLR。现在，我们要深入理解其核心——**偏回归系数 (Partial Regression Coefficient)**。

-   **回顾模型形式:** $Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + ... + \beta_k X_k + \epsilon$
-   **偏回归系数** $\beta_j$ 的意义 (核心！):
    -   $\beta_j$ 衡量的是，**在保持模型中所有其他自变量 (**$X_1, ..., X_{j-1}, X_{j+1}, ..., X_k$) 数值不变 (或称“控制住” Control For) 的条件下**，自变量 $X_j$ **每增加一个单位**时，因变量 Y 的**期望**平均变化量。
    -   它反映了 $X_j$ 对 Y 的**独立效应 (Independent Effect)** 或**调整后效应 (Adjusted Effect)**。
-   **为何重要？**
    -   现实世界中变量往往相互关联（存在混淆 Confounding）。如果不控制其他相关变量，我们可能会错误地估计某个变量的真实影响（遗漏变量偏误 Omitted Variable Bias）。
    -   MLR 通过将多个相关变量纳入模型，可以**分离出**每个自变量在控制了其他变量影响后的**净效应 (Net Effect)**。
-   **示例：预测汽车高速里程 (hwy)**
    -   **SLR:** `lm(hwy ~ displ, data = mpg)`

        -   `displ` 的系数 $\hat{\beta}_1 \approx -3.53$。这表示排量每增加 1 升，hwy 平均减少 3.53 MPG，**但这个估计可能混杂了其他与排量相关的因素（如气缸数、车重等）的影响**。

    -   **MLR:** `lm(hwy ~ displ + cyl + drv, data = mpg)` (加入气缸数 `cyl` 和驱动方式 `drv`)

        ```{r}
        library(tidyverse)
        mlr_model_mpg <- lm(hwy ~ displ + cyl + drv, data = mpg)
        summary(mlr_model_mpg)
        ```

        -   **解读 `displ` 的偏回归系数** $\hat{\beta}_{displ} \approx -1.1245$:
            -   **在保持气缸数 (cyl) 和驱动方式 (drv) 不变的情况下**，发动机排量 (displ) 每增加 1 升，高速公路里程 (hwy) **平均减少**约 1.12 MPG。
            -   **对比 SLR:** 这个系数 (-1.1245) 的绝对值小于 SLR 中的系数 (-3.53)。这表明，排量对里程的**部分**负面影响实际上是通过气缸数等其他因素体现的。控制了这些因素后，排量本身的**独立**负面影响变小了。
        -   **解读 `cyl` 的偏回归系数** $\hat{\beta}_{cyl} \approx -1.4509$:
            -   **在保持排量 (displ) 和驱动方式 (drv) 不变的情况下**，气缸数 (cyl) 每增加 1 个，高速公路里程 (hwy) **平均减少**约 1.45 MPG。
        -   **解读分类变量 `drv` (因子):** R 自动进行了虚拟编码 (Dummy Coding)。它选择一个参照组（这里是 `drv = '4'` 四驱），其他组别的系数表示**相对于参照组**的平均差异。
            -   `drvf` ($\hat{\beta}_{drvf} \approx 5.04$): **在保持排量和气缸数不变的情况下**，前驱 (`drv='f'`) 车辆的平均高速里程比四驱 (`drv='4'`) 车辆**高**约 5.04 MPG (且 P \< 0.05，差异显著)。
            -   `drvr` ($\hat{\beta}_{drvr} \approx 4.9$): **在保持排量和气缸数不变的情况下**，后驱 (`drv='r'`) 车辆的平均高速里程比四驱 (`drv='4'`) 车辆**高**约 4.9 MPG (且 P \< 0.05，差异显著)。

## 4. 统计显著性 vs 实际重要性

-   **统计显著性 (Statistical Significance):** 由 **P 值**决定。P 值 \< $\alpha$ 意味着我们有足够证据拒绝 $H_0$（例如，系数不为 0，或组间均值有差异）。它表明观察到的效应**不太可能**仅仅由随机抽样误差引起。
-   **实际重要性 (Practical Significance / Effect Size):** 指效应的**大小或幅度**在现实世界中是否有意义或值得关注。
-   **区分:**
    -   **大样本量**可能导致**非常小**的效应也具有**统计显著性**（P 值很小），但这个效应在实际应用中可能微不足道。
    -   **小样本量**可能导致**很大**的效应却**不具有**统计显著性（P 值较大），因为证据不足。
-   **评估实际重要性:**
    -   **回归系数的大小:** $\beta_j$ 的值本身有多大？结合业务背景判断这个变化量是否有意义。
    -   **R²:** 模型解释了多少变异？(虽然 R² 高不代表模型一定好或有因果关系)。
    -   **置信区间:** 系数的置信区间宽度和位置提供了效应大小不确定性的信息。
    -   **标准化系数 (Standardized Coefficients, Betas):** (后续可能涉及) 将所有变量标准化后进行回归，得到的系数可以比较不同自变量的相对重要性（因为它们在同一尺度上）。
    -   **领域知识 (Domain Knowledge):** 结合专业背景判断效应是否重要。

::: {.callout-warning title="警惕 P 值崇拜"}
不要仅仅根据 P 值 \< 0.05 就认为结果一定重要。要结合效应大小、置信区间、研究背景和实际影响来综合判断。
:::

## 5. 回归模型的假设 (L.I.N.E.)

线性回归模型（包括 SLR 和 MLR）的有效性依赖于一些关键假设。如果这些假设严重违背，模型的预测和推断结果可能不可靠。

1.  **线性性 (Linearity):** 因变量 $Y$ 与**每个**自变量 $X_j$ 之间的关系是**线性的**（在控制其他变量后）。
    -   **检查:** 残差图 (Residuals vs Fitted plot)，残差应该随机散布在 0 附近，没有明显模式（如曲线）。也可以绘制部分残差图 (Partial Residual Plots)。
    -   **后果:** 如果关系是非线性的，线性模型拟合会很差，预测不准。
    -   **处理:** 变量变换（如 $\log(Y)$, $X^2$），加入非线性项，使用非线性模型。
2.  **独立性 (Independence):** **误差项** $\epsilon_i$ (或观测值 $Y_i$) 之间相互独立。
    -   **检查:** 通常根据研究设计判断（如时间序列数据、聚类数据可能违背）。也可以检查残差的自相关性 (Durbin-Watson test)。
    -   **后果:** 标准误估计偏低，导致 P 值偏小，容易犯第一类错误。
    -   **处理:** 使用考虑了依赖性的模型（如时间序列模型、多层模型）。
3.  **正态性 (Normality):** **误差项** $\epsilon$ 服从**正态分布**。注意：是**误差项**，不是 $Y$ 或 $X$ 本身！
    -   **检查:** 残差的正态 QQ 图 (Normal Q-Q plot)，点应大致落在直线上；残差的直方图；Shapiro-Wilk 检验。
    -   **后果:** 在小样本下，系数的置信区间和 P 值可能不准确。但在大样本下（CLT），t 检验和 F 检验对轻微偏离正态性比较稳健。
    -   **处理:** 变量变换，使用稳健回归方法。
4.  **等方差性 (Equal Variance / Homoscedasticity):** **误差项** $\epsilon$ 的方差对于**所有**自变量的取值水平都是**恒定的** ($\sigma^2$)。
    -   **检查:** 残差图 (Residuals vs Fitted plot)，点的散布宽度应该大致均匀，没有喇叭形或扇形。也可以用 Breusch-Pagan 检验等。
    -   **后果:** OLS 估计仍然是无偏的，但标准误和 P 值不准确。
    -   **处理:** 变量变换（如 $\log(Y)$），使用加权最小二乘法 (WLS) 或稳健标准误。

::: {.callout-info title="L.I.N.E. 助记"}
**L**inearity, **I**ndependence, **N**ormality, **E**qual Variance. 这些是经典 OLS 回归的核心假设。我们将在下一周学习如何通过**模型诊断**来检查这些假设。
:::

## 6. AI 辅助理解与验证

AI 工具可以帮助我们回顾概念和解释结果，但务必谨慎使用。

::: {.callout-tip title="AI 辅助演示 (需验证！)"}
-   **回顾概念:** "请解释多元线性回归中偏回归系数的概念" 或 "线性回归的假设(LINE)有哪些？"
-   **解释 MLR 系数:** (提供 `summary()` 输出) "请解释这个 R 回归输出中 'displ' 的系数，并考虑模型中的其他变量"
-   **比较 SLR 和 MLR 系数:** "为什么在简单线性回归(hwy \~ displ)和多元线性回归(hwy \~ displ + cyl + drv)中，'displ' 的系数会不同？"

**特别提醒：** AI生成的内容可能存在不准确或不够细致的问题。**请务必结合课堂所学知识和教材内容进行批判性思考和验证。** 切勿直接将AI的解释作为最终答案直接使用。
:::

## 7. 本周总结与预告

本周我们系统回顾了第一阶段的知识体系，并深入探讨了多元线性回归的核心——偏回归系数的意义和解释，以及统计显著性与实际重要性的区别。我们还重温了线性回归的关键假设 (L.I.N.E.)，为下周的模型诊断打下基础。

**下周预告:** 模型拟合好了，但它可靠吗？下周我们将学习**回归模型诊断**的实战技术，利用各种图形和检验方法来检查 L.I.N.E. 假设是否满足，并识别模型中可能存在的问题（如异常值、强影响点、多重共线性）。