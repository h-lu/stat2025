## ç¾é£Ÿç”»å·å±•ç¤º {.section-title}

åœ¨å¼€å§‹æ·±å…¥æ¢ç´¢ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥æ¬£èµä¸€ç•ªç¾é£Ÿä¸–ç•Œçš„å¤šå½©é£è²Œã€‚é€šè¿‡è¿™äº›å¯è§†åŒ–å›¾è¡¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç›´è§‚åœ°æ„Ÿå—åˆ°ä¸åŒé£Ÿç‰©ç±»åˆ«çš„è¥å…»ç‰¹ç‚¹ï¼Œä¸ºåç»­çš„æ·±å…¥åˆ†ææ‰“ä¸‹åŸºç¡€ã€‚

### é£Ÿç‰©ç±»åˆ«çš„è¥å…»ç‰¹å¾

```{r category-radar}
# å‡†å¤‡é›·è¾¾å›¾æ•°æ®
radar_data <- food_by_category %>%
  select(food_category, avg_protein, avg_carbs, avg_fat, avg_fiber, avg_sugar) %>%
  mutate(across(where(is.numeric), ~ scale(.) %>% as.vector()))

# è½¬æ¢ä¸ºé•¿æ ¼å¼
radar_long <- radar_data %>%
  pivot_longer(cols = -food_category, 
               names_to = "nutrient", 
               values_to = "value") %>%
  mutate(nutrient = factor(nutrient, 
                         levels = c("avg_protein", "avg_carbs", "avg_fat", "avg_fiber", "avg_sugar"),
                         labels = c("è›‹ç™½è´¨", "ç¢³æ°´åŒ–åˆç‰©", "è„‚è‚ª", "çº¤ç»´", "ç³–åˆ†")))

# ç»˜åˆ¶é›·è¾¾å›¾çš„æ›¿ä»£å“ï¼šåˆ†é¢çš„æåæ ‡æ¡å½¢å›¾
ggplot(radar_long, aes(x = nutrient, y = value, fill = food_category)) +
  geom_col(position = "dodge", width = 0.8, color = "white", alpha = 0.8) +
  facet_wrap(~food_category, nrow = 2) +
  scale_fill_manual(values = food_colors) +
  coord_polar() +
  labs(title = "å„ç±»é£Ÿç‰©çš„è¥å…»æˆåˆ†åˆ†å¸ƒ",
       subtitle = "æ ‡å‡†åŒ–åçš„æ•°å€¼æ¯”è¾ƒ",
       x = NULL,
       y = NULL,
       fill = "é£Ÿç‰©ç±»åˆ«") +
  food_theme +
  theme(
    axis.text.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    legend.position = "none",
    strip.text = element_text(size = 12, face = "bold")
  )
```

```{r calorie-distribution}
# çƒ­é‡åˆ†å¸ƒ
ggplot(food_unique, aes(x = food_category, y = calories_per_100g, fill = food_category)) +
  geom_boxplot(alpha = 0.8, outlier.shape = 21, outlier.fill = "white") +
  geom_jitter(width = 0.2, alpha = 0.5, size = 2) +
  scale_fill_manual(values = food_colors) +
  labs(title = "ä¸åŒé£Ÿç‰©ç±»åˆ«çš„çƒ­é‡åˆ†å¸ƒ",
       subtitle = "æ¯100å…‹é£Ÿç‰©çš„å¡è·¯é‡Œå«é‡",
       x = NULL,
       y = "çƒ­é‡ (å¡è·¯é‡Œ/100å…‹)",
       fill = "é£Ÿç‰©ç±»åˆ«") +
  food_theme +
  theme(legend.position = "none") +
  coord_flip()
```

### é£Ÿç‰©è¥å…»çš„ç›¸äº’å…³ç³»

```{r nutrient-correlation}
# è¥å…»æˆåˆ†ä¹‹é—´çš„ç›¸å…³æ€§çƒ­å›¾
nutrient_cor <- food_unique %>%
  select(calories_per_100g, protein_per_100g, carbs_per_100g, fat_per_100g, fiber_per_100g, sugar_per_100g, sodium_per_100g) %>%
  rename("çƒ­é‡" = calories_per_100g,
         "è›‹ç™½è´¨" = protein_per_100g,
         "ç¢³æ°´åŒ–åˆç‰©" = carbs_per_100g,
         "è„‚è‚ª" = fat_per_100g,
         "çº¤ç»´" = fiber_per_100g,
         "ç³–åˆ†" = sugar_per_100g,
         "é’ " = sodium_per_100g) %>%
  cor() %>%
  round(2)

# è½¬æ¢ä¸ºé•¿æ ¼å¼ç”¨äºç»˜å›¾
cor_long <- nutrient_cor %>%
  as.data.frame() %>%
  rownames_to_column("var1") %>%
  pivot_longer(-var1, names_to = "var2", values_to = "correlation")

# ç»˜åˆ¶çƒ­å›¾
ggplot(cor_long, aes(x = var1, y = var2, fill = correlation)) +
  geom_tile(color = "white") +
  geom_text(aes(label = correlation), color = "black", size = 3) +
  scale_fill_gradient2(low = "#8ECAE6", mid = "white", high = "#FF7F50", midpoint = 0,
                      limits = c(-1, 1)) +
  labs(title = "è¥å…»æˆåˆ†ä¹‹é—´çš„ç›¸å…³æ€§",
       subtitle = "Pearsonç›¸å…³ç³»æ•°",
       x = NULL,
       y = NULL,
       fill = "ç›¸å…³ç³»æ•°") +
  food_theme +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right"
  )
```

```{r protein-fat-calories}
# è›‹ç™½è´¨ã€è„‚è‚ªä¸çƒ­é‡çš„å…³ç³»
ggplot(food_unique, aes(x = protein_per_100g, y = fat_per_100g, size = calories_per_100g, color = food_category)) +
  geom_point(alpha = 0.7) +
  scale_color_manual(values = food_colors) +
  scale_size_continuous(range = c(2, 8)) +
  labs(title = "è›‹ç™½è´¨ã€è„‚è‚ªä¸çƒ­é‡çš„å…³ç³»",
       subtitle = "åœ†åœˆå¤§å°ä»£è¡¨çƒ­é‡å«é‡",
       x = "è›‹ç™½è´¨ (å…‹/100å…‹)",
       y = "è„‚è‚ª (å…‹/100å…‹)",
       color = "é£Ÿç‰©ç±»åˆ«",
       size = "çƒ­é‡ (å¡è·¯é‡Œ/100å…‹)") +
  food_theme +
  theme(legend.position = "right")
```

### é£Ÿç‰©æ¥æºçš„è¥å…»å·®å¼‚

```{r source-comparison}
# é£Ÿç‰©æ¥æºè¥å…»å¯¹æ¯”
source_long <- food_by_source %>%
  select(food_source, avg_protein, avg_carbs, avg_fat, avg_fiber) %>%
  pivot_longer(-food_source, names_to = "nutrient", values_to = "value") %>%
  mutate(nutrient = factor(nutrient, 
                         levels = c("avg_protein", "avg_carbs", "avg_fat", "avg_fiber"),
                         labels = c("è›‹ç™½è´¨", "ç¢³æ°´åŒ–åˆç‰©", "è„‚è‚ª", "çº¤ç»´")))

# ç»˜åˆ¶åˆ†ç»„æ¡å½¢å›¾
ggplot(source_long, aes(x = nutrient, y = value, fill = food_source)) +
  geom_col(position = "dodge", width = 0.7, color = "white") +
  scale_fill_manual(values = food_colors[7:9]) +
  labs(title = "ä¸åŒé£Ÿç‰©æ¥æºçš„è¥å…»æˆåˆ†å¯¹æ¯”",
       subtitle = "æ¯100å…‹çš„å¹³å‡å«é‡",
       x = NULL,
       y = "å«é‡ (å…‹/100å…‹)",
       fill = "é£Ÿç‰©æ¥æº") +
  food_theme
```

```{r food-ridgeplot}
# ä¸åŒé£Ÿç‰©ç±»åˆ«çš„çƒ­é‡åˆ†å¸ƒå±±è„Šå›¾
ggplot(food_unique, aes(x = calories_per_100g, y = food_category, fill = food_category)) +
  geom_density_ridges(alpha = 0.7, scale = 0.9, quantile_lines = TRUE, quantiles = 2) +
  scale_fill_manual(values = food_colors) +
  labs(title = "ä¸åŒé£Ÿç‰©ç±»åˆ«çš„çƒ­é‡åˆ†å¸ƒ",
       subtitle = "å±±è„Šå›¾å±•ç¤ºçƒ­é‡åˆ†å¸ƒè½®å»“ï¼Œä¸­çº¿ä»£è¡¨ä¸­ä½æ•°",
       x = "çƒ­é‡ (å¡è·¯é‡Œ/100å…‹)",
       y = NULL,
       fill = "é£Ÿç‰©ç±»åˆ«") +
  food_theme +
  theme(legend.position = "none")
```

é€šè¿‡è¿™äº›å¯è§†åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é£Ÿç‰©ä¸–ç•Œä¸­ä¸°å¯Œå¤šå½©çš„è¥å…»æ¨¡å¼ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥æ·±å…¥åˆ†æè¿™äº›æ•°æ®ï¼Œæ¢ç´¢æ›´å¤šæœ‰è¶£çš„å‘ç°ã€‚

```{r food-emoji, include=FALSE}
# ä¸ºäº†ä¸‹ä¸€æ­¥åˆ†æåšå‡†å¤‡ï¼Œåˆ›å»ºé£Ÿç‰©ç±»åˆ«ä¸è¡¨æƒ…ç¬¦å·çš„å¯¹åº”å…³ç³»
food_emoji <- c(
  "ç”œç‚¹" = "ğŸ°",
  "è‚‰ç±»" = "ğŸ¥©",
  "è”¬æœ/ç´ é£Ÿ" = "ğŸ¥—",
  "å¿«é¤" = "ğŸ”",
  "æµ·é²œ" = "ğŸ¦",
  "æ±¤/é¥®å“" = "ğŸ²"
)
``` 