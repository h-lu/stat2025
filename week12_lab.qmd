---
title: "第十二周实验：Logistic 回归评估与模型比较"
---

## 1. 目标

本实验旨在练习评估 Logistic 回归模型的性能，理解各种评估指标的含义和计算方法，并初步实践模型比较。

-   从拟合的 Logistic 回归模型生成预测概率和预测类别。
-   使用 `table()` 或 `yardstick::conf_mat()` 创建和解读混淆矩阵。
-   使用 `yardstick` 包计算并解释 Accuracy, Precision, Recall, Specificity, F1-Score。
-   理解不同评估指标的侧重点和适用场景。
-   使用 `yardstick` 包绘制 ROC 曲线并计算 AUC 值，评估模型的整体区分能力。
-   使用 `AIC()` 和 `BIC()` 比较不同 Logistic 回归模型的相对优劣。
-   讨论综合实践项目选题和初步 EDA。

## 2. 数据与模型准备

我们将继续使用上周的 `ISLR::Default` 数据集和拟合的多元 Logistic 回归模型 `logistic_multi`。

```{r setup-data-w12}
library(tidyverse)
# install.packages("ISLR") # 如果尚未安装
library(ISLR)
library(broom)
# install.packages("yardstick") # 如果尚未安装
library(yardstick) # For metrics: conf_mat, accuracy, precision, recall, f_meas, spec

# 加载数据并回顾模型
data("Default")
logistic_multi <- glm(default ~ balance + income + student, data = Default, family = binomial)
```

## 3. 混淆矩阵与基础指标

**任务:**

1. 使用 `yardstick::conf_mat()` 创建混淆矩阵。
2. 手动识别混淆矩阵中的 TP, FN, FP, TN (假设 "Yes" 是 Positive 类)。
3. 使用 `yardstick` 函数计算以下指标，并解释其含义：
  * Accuracy
  * Precision
  * Recall
  * Specificity
  * F1-Score

**思考:**

-   在这个 `Default` 数据集中，类别是否平衡？（提示：查看 `summary(Default$default)` 或 `table(Default$default)`）。如果不平衡，Accuracy 是一个好的评估指标吗？为什么？
-   对于信用卡违约预测，你认为 Precision 和 Recall 哪个更重要？或者说，误报 (FP - 将未违约者预测为违约) 和漏报 (FN - 将违约者预测为未违约) 哪个代价更大？这会如何影响你对模型的评估侧重？

## 4. ROC 曲线与 AUC

**任务:** 

1. 使用 `yardstick::roc_curve()` 函数，根据真实观测值和预测概率创建 ROC 对象。确保正确指定 `levels` 参数。
2. 使用 `yardstick::roc_auc()` 计算 AUC 值。
3. 解读 AUC 值的含义（模型的整体区分能力如何？）。
4. 使用 `yardstick::autoplot()` 绘制 ROC 曲线，并添加对角线和 AUC 值标注。

## 5. 模型比较 (AIC/BIC)

**场景:** 比较上周拟合的两个 Logistic 回归模型：

- `logistic_simple`: `default ~ balance + student`
- `logistic_multi`: `default ~ balance + income + student`

**任务:** 

1. 重新拟合 `logistic_simple` 模型（如果需要）。
2. 使用 `AIC()` 和 `BIC()` 比较这两个模型。
3. 哪个模型的 AIC 和 BIC 更低？根据这些信息准则，哪个模型相对更优？这是否符合你对模型复杂度和拟合效果的直观感受？


## 6. 综合实践项目进展讨论

**任务:**

1. **分享你的选题:** 向小组或全班简要介绍你选择的综合实践项目主题、研究问题和数据来源。
2. **展示初步 EDA:** 展示你使用 `ggplot2` 等工具进行的初步数据探索结果（关键变量分布、变量关系图等）。
3. **讨论遇到的问题:** 分享你在数据获取、清理或初步探索中遇到的困难或疑问。
4. **接受反馈:** 听取老师、助教和同学的建议。

## 7. 实验总结

在本实验中，我们深入实践了 Logistic 回归模型的评估。我们学会了如何生成预测、构建混淆矩阵，并计算和解释了 Accuracy, Precision, Recall, Specificity, F1-Score 等关键指标。我们还掌握了使用 ROC 曲线和 AUC 值来评估模型整体区分能力的方法。最后，我们练习了使用 AIC/BIC 来比较不同 Logistic 回归模型。这些评估技能对于理解和选择合适的分类模型至关重要。同时，我们也推进了综合实践项目的选题和初步探索。