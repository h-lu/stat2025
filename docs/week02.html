<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>第二周：R语言数据导入与常用数据包 – 统计学与R语言</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./week03.html" rel="next">
<link href="./week01.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week01.html">课程内容</a></li><li class="breadcrumb-item"><a href="./week02.html"><span class="chapter-title">第二周：R语言数据导入与常用数据包</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">统计学与R语言</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">欢迎</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllbus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">课程概述</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">课程内容</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">第一周：项目启动与统计学导论</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week02.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">第二周：R语言数据导入与常用数据包</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week03.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">统计学讲义 - 第三周：描述性统计：数据探索与可视化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week04.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">统计学讲义 - 第四周：推断性统计初步：参数估计与假设检验</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#掌握r语言数据读取利器" id="toc-掌握r语言数据读取利器" class="nav-link active" data-scroll-target="#掌握r语言数据读取利器">掌握R语言数据读取利器</a></li>
  <li><a href="#r-语言数据导入常用包readr-vs-datatable" id="toc-r-语言数据导入常用包readr-vs-datatable" class="nav-link" data-scroll-target="#r-语言数据导入常用包readr-vs-datatable">1. R 语言数据导入常用包：<code>readr</code> vs <code>datatable</code></a></li>
  <li><a href="#使用-flights-数据集演示数据导入导出" id="toc-使用-flights-数据集演示数据导入导出" class="nav-link" data-scroll-target="#使用-flights-数据集演示数据导入导出">2. 使用 <code>flights</code> 数据集演示数据导入导出</a></li>
  <li><a href="#r-语言基本数据类型" id="toc-r-语言基本数据类型" class="nav-link" data-scroll-target="#r-语言基本数据类型">3. R 语言基本数据类型</a></li>
  <li><a href="#r-语言常用统计函数" id="toc-r-语言常用统计函数" class="nav-link" data-scroll-target="#r-语言常用统计函数">4. R 语言常用统计函数</a></li>
  <li><a href="#dplyr-包基础数据框操作利器" id="toc-dplyr-包基础数据框操作利器" class="nav-link" data-scroll-target="#dplyr-包基础数据框操作利器">5. <code>dplyr</code> 包基础：数据框操作利器</a></li>
  <li><a href="#本周内容总结与下周预告" id="toc-本周内容总结与下周预告" class="nav-link" data-scroll-target="#本周内容总结与下周预告">6. 本周内容总结与下周预告</a></li>
  <li><a href="#课后任务" id="toc-课后任务" class="nav-link" data-scroll-target="#课后任务">7. 课后任务</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week01.html">课程内容</a></li><li class="breadcrumb-item"><a href="./week02.html"><span class="chapter-title">第二周：R语言数据导入与常用数据包</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">第二周：R语言数据导入与常用数据包</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="掌握r语言数据读取利器" class="level3">
<h3 class="anchored" data-anchor-id="掌握r语言数据读取利器">掌握R语言数据读取利器</h3>
<p>上周我们学习了数据获取的基本方法。本周，我们将深入学习<strong>R语言数据导入</strong>，掌握使用 R 读取各种数据格式的技能。我们将重点介绍 <code>tidyverse</code> 生态中的 <code>readr</code> 包和高性能的 <code>datatable</code> 包，并学习 R 中的基本数据类型、常用统计函数以及 <code>dplyr</code> 包的基础用法，为后续的数据分析打下更坚实的基础。</p>
<p><strong>继续使用 VS Code 或 Cursor + AI 插件：</strong> 请继续使用 VS Code 或 Cursor 编辑器，并充分利用 AI 插件的代码辅助、智能提示、聊天问答等功能，提升学习效率。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
本周学习目标
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>R 数据导入进阶:</strong> 掌握 <code>readr</code> 和 <code>datatable</code> 包导入各种数据格式。</li>
<li><strong>数据包对比:</strong> 了解 <code>readr</code> 和 <code>datatable</code> 的特点和适用场景。</li>
<li><strong>R 数据类型:</strong> 熟悉 R 中的基本数据类型。</li>
<li><strong>常用统计函数:</strong> 掌握 R 中常用的统计函数。</li>
<li><strong><code>dplyr</code> 基础:</strong> 初步掌握 <code>dplyr</code> 包的基本数据操作。</li>
<li><strong>实战演练:</strong> 使用 <code>flights</code> 数据集进行数据导入和导出练习。</li>
<li><strong>AI 辅助数据操作:</strong> 继续探索使用 AI 工具辅助 R 数据操作。</li>
</ul>
</div>
</div>
<hr>
</section>
<section id="r-语言数据导入常用包readr-vs-datatable" class="level3">
<h3 class="anchored" data-anchor-id="r-语言数据导入常用包readr-vs-datatable">1. R 语言数据导入常用包：<code>readr</code> vs <code>datatable</code></h3>
<ul>
<li><p><strong><code>tidyverse</code> <code>readr</code> 包 (回顾与进阶):</strong></p>
<ul>
<li><strong>快速便捷:</strong> <code>readr</code> 包是 <code>tidyverse</code> 核心包之一，专注于快速、方便地读取各种表格数据文件 (CSV, TXT, TSV 等)。</li>
<li><strong>自动类型推断:</strong> <code>readr</code> 能够自动检测列的数据类型，并进行合理的转换。</li>
<li><strong>灵活的参数设置:</strong> <code>readr</code> 提供了丰富的参数，可以灵活控制数据导入过程，例如，指定列名、跳过行、限制读取行数、自定义分隔符、处理缺失值、指定列类型、处理编码问题等。</li>
<li><strong>返回 <code>tibble</code> 数据框:</strong> <code>readr</code> 读取的数据默认是 <code>tibble</code> 格式，是 <code>tidyverse</code> 推荐使用的数据框，打印输出更友好，子集操作更严谨。</li>
<li><strong>常用函数:</strong>
<ul>
<li><code>read_csv()</code>: 读取逗号分隔的 CSV 文件。</li>
<li><code>read_tsv()</code>: 读取制表符分隔的 TSV 文件。</li>
<li><code>read_delim()</code>: 读取更广泛的分隔符文件，可以自定义分隔符。</li>
<li><code>read_fwf()</code>: 读取固定宽度的文件。</li>
<li><code>read_table()</code>: 读取空格分隔的表格文件。</li>
</ul></li>
<li><strong>进阶用法:</strong> 上周我们已经学习了 <code>read_csv()</code> 和 <code>read_tsv()</code> 的基本用法。 本周我们进一步学习 <code>readr</code> 的进阶用法，例如：
<ul>
<li><strong><code>col_names</code> 参数:</strong> 用于指定列名。 可以传入字符向量作为列名，或者 <code>col_names = FALSE</code> 表示数据文件的第一行不是列名。</li>
<li><strong><code>skip</code> 参数:</strong> 用于跳过文件开头的若干行。 例如，<code>skip = 1</code> 跳过第一行。</li>
<li><strong><code>n_max</code> 参数:</strong> 用于限制最多读取的行数。 例如，<code>n_max = 100</code> 只读取前 100 行。</li>
<li><strong><code>col_types</code> 参数:</strong> 用于手动指定每一列的数据类型。 例如，<code>col_types = cols(col1 = col_character(), col2 = col_double())</code> 指定 <code>col1</code> 为字符型，<code>col2</code> 为数值型。 常用的类型包括 <code>col_character()</code>, <code>col_double()</code>, <code>col_integer()</code>, <code>col_logical()</code>, <code>col_factor()</code>, <code>col_date()</code>, <code>col_datetime()</code>, <code>col_time()</code>, <code>col_number()</code>, <code>col_currency()</code>, <code>col_skip()</code>, <code>col_guess()</code>.</li>
<li><strong><code>locale</code> 参数:</strong> 用于处理不同地区的文化和语言习惯，例如，日期和时间格式、小数点和千位分隔符、字符编码等。 可以使用 <code>locale()</code> 函数创建 locale 对象，并传入 <code>locale</code> 参数。 例如，<code>locale = locale(encoding = "GBK")</code> 指定使用 GBK 编码。</li>
</ul></li>
</ul></li>
<li><p><strong><code>datatable</code> 包 (高性能数据读取):</strong></p>
<ul>
<li><p><strong>快速高效:</strong> <code>datatable</code> 包是一个高性能的数据处理包，其数据读取速度非常快，尤其是在处理大型数据文件时，速度远超 <code>readr</code> 和 R 基础函数。 <code>datatable</code> 包使用 C 语言编写，底层优化，效率极高。</p></li>
<li><p><strong><code>fread()</code> 函数:</strong> <code>datatable</code> 包最核心的函数是 <code>fread()</code>，用于快速读取各种格式的表格数据文件 (包括 CSV, TXT 等)。 <code>fread()</code> 功能强大，参数丰富，可以灵活控制数据导入过程。</p></li>
<li><p><strong>自动类型推断 (更智能):</strong> <code>fread()</code> 的自动类型推断功能比 <code>readr</code> 更智能，能够更准确地识别列的数据类型，并进行高效的转换。</p></li>
<li><p><strong>多线程读取:</strong> <code>fread()</code> 支持多线程读取，可以充分利用多核 CPU 的性能，进一步提高读取速度 (默认使用所有可用 CPU 核心)。</p></li>
<li><p><strong>语法简洁:</strong> <code>fread()</code> 的语法简洁易用，很多参数都有默认值，通常只需指定文件路径即可快速读取数据。</p></li>
<li><p><strong>返回 <code>data.table</code> 数据框:</strong> <code>fread()</code> 读取的数据是 <code>data.table</code> 格式。 <code>data.table</code> 是 <code>datatable</code> 包定义的一种高性能数据框，在数据处理和分析方面具有很多优势，例如，速度更快、语法更简洁、功能更强大。 <code>data.table</code> 的语法和操作方式与 R 基础的 <code>data.frame</code> 和 <code>tidyverse</code> 的 <code>tibble</code> 有所不同，需要学习其特有的语法。 <strong>本课程中，我们主要使用 <code>tibble</code> 数据框进行数据分析，<code>data.table</code> 作为扩展学习内容，感兴趣的同学可以深入学习。</strong></p></li>
<li><p><strong>基本用法:</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装和加载 datatable 包 (如果已安装，则只需加载)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("data.table")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 fread() 读取 CSV 文件</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>data_dt <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"your_data.csv"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印数据框</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>常用参数:</strong> <code>fread()</code> 函数有很多参数，常用的参数包括：</p>
<ul>
<li><code>file</code>: 文件路径。</li>
<li><code>sep</code>: 分隔符。 默认自动检测，通常无需手动指定。</li>
<li><code>header</code>: 逻辑值，是否将第一行作为列名。 默认为 <code>TRUE</code>。</li>
<li><code>col.names</code>: 用于指定列名。</li>
<li><code>skip</code>: 用于跳过文件开头的若干行。</li>
<li><code>nrows</code>: 用于限制最多读取的行数。</li>
<li><code>colClasses</code>: 用于手动指定每一列的数据类型。 例如，<code>colClasses = c("character", "numeric")</code> 指定第一列为字符型，第二列为数值型。</li>
<li><code>encoding</code>: 字符编码。 例如，<code>encoding = "GBK"</code> 指定使用 GBK 编码。</li>
</ul></li>
</ul></li>
<li><p><strong><code>readr</code> vs <code>datatable</code> 总结:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>特性</th>
<th><code>readr</code> (<code>tidyverse</code>)</th>
<th><code>datatable</code> (<code>fread()</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>速度</strong></td>
<td>较快</td>
<td><strong>非常快</strong></td>
</tr>
<tr class="even">
<td><strong>易用性</strong></td>
<td>非常易用</td>
<td>易用</td>
</tr>
<tr class="odd">
<td><strong>功能</strong></td>
<td>功能丰富</td>
<td>功能强大</td>
</tr>
<tr class="even">
<td><strong>类型推断</strong></td>
<td>自动</td>
<td><strong>更智能自动</strong></td>
</tr>
<tr class="odd">
<td><strong>数据框</strong></td>
<td><code>tibble</code></td>
<td><code>data.table</code></td>
</tr>
<tr class="even">
<td><strong>依赖</strong></td>
<td><code>tidyverse</code></td>
<td><code>datatable</code></td>
</tr>
<tr class="odd">
<td><strong>适用场景</strong></td>
<td>常用数据导入</td>
<td><strong>大型数据文件导入</strong></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>选择建议:</strong>
<ul>
<li><strong>对于一般的数据导入任务，<code>readr</code> 包已经足够快速和方便，是首选。</strong> <code>readr</code> 易用性好，与 <code>tidyverse</code> 生态系统兼容性好，是数据分析的常用工具。</li>
<li><strong>当需要处理非常大的数据文件，或者对数据读取速度有极高要求时，可以考虑使用 <code>datatable</code> 包的 <code>fread()</code> 函数。</strong> <code>fread()</code> 速度极快，性能卓越，是处理大数据的不二之选。 但需要注意 <code>fread()</code> 返回的是 <code>data.table</code> 数据框，其语法和操作方式与 <code>tibble</code> 有所不同。</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="使用-flights-数据集演示数据导入导出" class="level3">
<h3 class="anchored" data-anchor-id="使用-flights-数据集演示数据导入导出">2. 使用 <code>flights</code> 数据集演示数据导入导出</h3>
<ul>
<li><p><strong><code>flights</code> 数据集介绍:</strong> <code>nycflights13</code> 包中包含了 2013 年纽约出发的所有航班数据，是一个非常经典的数据分析和演示数据集。 <code>tidyverse</code> 的很多教程和示例都使用 <code>flights</code> 数据集。</p>
<ul>
<li><p><strong>加载 <code>nycflights13</code> 包:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装和加载 nycflights13 包 (如果已安装，则只需加载)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("nycflights13")</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看 flights 数据集</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong><code>flights</code> 数据框:</strong> <code>flights</code> 是一个 <code>tibble</code> 数据框，包含了航班的各种信息，例如，出发时间、到达时间、航空公司、航班号、出发机场、到达机场、飞行距离、飞行时长等。 可以使用 <code>?flights</code> 查看数据集的详细信息。</p></li>
</ul></li>
<li><p><strong>保存 <code>flights</code> 数据为 CSV 文件:</strong></p>
<ul>
<li><p><strong>使用 <code>readr</code> <code>write_csv()</code> 函数:</strong> <code>readr</code> 包提供了 <code>write_csv()</code> 函数，用于将数据框保存为 CSV 文件。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 write_csv() 保存 flights 数据为 CSV 文件</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(flights, <span class="st">"flights.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 提示：CSV 文件已保存到当前工作目录下</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>write_csv()</code> 函数:</strong> 第一个参数是要保存的数据框，第二个参数是 CSV 文件名 (带引号)。 默认使用逗号作为分隔符，UTF-8 编码，第一行写入列名。</li>
<li><strong>当前工作目录:</strong> CSV 文件默认保存到 R 的当前工作目录下。 可以使用 <code>getwd()</code> 函数查看当前工作目录，使用 <code>setwd("your_path")</code> 设置工作目录。 建议将数据文件保存在项目文件夹下的 <code>data</code> 子文件夹中，方便管理。</li>
</ul></li>
</ul></li>
<li><p><strong>使用 <code>readr</code> <code>read_csv()</code> 函数读取 CSV 文件:</strong></p>
<ul>
<li><p><strong>从 CSV 文件读取数据:</strong> 使用 <code>read_csv()</code> 函数读取刚刚保存的 <code>flights.csv</code> 文件。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 read_csv() 读取 CSV 文件</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>flights_readr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"flights.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印读取的数据</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(flights_readr)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查数据是否与原始 flights 数据集一致</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(flights, flights_readr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>identical()</code> 函数:</strong> 用于比较两个 R 对象是否完全相同 (包括数据和属性)。 如果返回 <code>TRUE</code>，则表示两个对象完全一致。</li>
</ul></li>
</ul></li>
<li><p><strong>使用 <code>datatable</code> <code>fwrite()</code> 和 <code>fread()</code> 函数进行数据导入导出:</strong></p>
<ul>
<li><p><strong><code>fwrite()</code> 函数:</strong> <code>datatable</code> 包提供了 <code>fwrite()</code> 函数，用于快速将 <code>data.table</code> 或 <code>data.frame</code> 保存为文件 (包括 CSV, TXT 等)。 <code>fwrite()</code> 速度非常快，性能优异。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 flights 数据转换为 data.table 格式</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>flights_dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(flights)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 fwrite() 保存 data.table 为 CSV 文件</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(flights_dt, <span class="st">"flights_dt.csv"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 提示：CSV 文件已保存到当前工作目录下</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>as.data.table()</code> 函数:</strong> 用于将其他格式的数据框 (例如 <code>tibble</code>, <code>data.frame</code>) 转换为 <code>data.table</code> 格式。 如果数据已经是 <code>data.table</code> 格式，则无需转换。</li>
<li><strong><code>fwrite()</code> 函数:</strong> 第一个参数是要保存的 <code>data.table</code>，第二个参数是文件名。 默认使用逗号分隔符，UTF-8 编码，第一行写入列名。</li>
</ul></li>
<li><p><strong><code>fread()</code> 函数:</strong> 使用 <code>fread()</code> 函数读取 <code>fwrite()</code> 保存的 <code>flights_dt.csv</code> 文件。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 fread() 读取 CSV 文件</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>flights_fread <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"flights_dt.csv"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印读取的数据</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(flights_fread)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查数据是否与原始 flights_dt 数据集一致</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(flights_dt, flights_fread)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p><strong>数据导入导出练习:</strong> 鼓励学生尝试使用 <code>readr</code> 和 <code>datatable</code> 包的不同函数和参数，进行数据导入导出练习，例如：</p>
<ul>
<li>使用 <code>write_tsv()</code> 和 <code>read_tsv()</code> 保存和读取 TSV 文件。</li>
<li>使用 <code>write.table()</code> 和 <code>read.table()</code> (R 基础函数) 进行数据导入导出，并比较速度和用法。</li>
<li>尝试使用 <code>col_names</code>, <code>skip</code>, <code>n_max</code>, <code>col_types</code>, <code>encoding</code> 等参数，控制数据导入过程。</li>
</ul></li>
</ul>
</section>
<section id="r-语言基本数据类型" class="level3">
<h3 class="anchored" data-anchor-id="r-语言基本数据类型">3. R 语言基本数据类型</h3>
<ul>
<li><p><strong>R 的数据类型:</strong> R 语言是一种动态类型语言，变量的类型不需要显式声明，R 会自动根据赋值内容判断变量类型。 R 中常用的基本数据类型包括：</p>
<ul>
<li><strong>数值型 (numeric):</strong> 用于表示数值数据，包括整数和小数。 例如，<code>10</code>, <code>3.14</code>, <code>-5.2</code>。 数值型是 R 中最常用的数据类型。</li>
<li><strong>字符型 (character):</strong> 用于表示文本数据，用引号 (单引号或双引号) 包围。 例如， <code>"hello"</code>, <code>'world'</code>, <code>"统计学"</code>, <code>'R 语言'</code>。</li>
<li><strong>逻辑型 (logical):</strong> 用于表示逻辑值，只有两个取值：<code>TRUE</code> (真) 和 <code>FALSE</code> (假)。 逻辑值常用于条件判断和逻辑运算。 例如， <code>TRUE</code>, <code>FALSE</code>, <code>10 &gt; 5</code> (结果为 <code>TRUE</code>), <code>"a" == "b"</code> (结果为 <code>FALSE</code>)。</li>
<li><strong>因子型 (factor):</strong> 用于表示分类数据或名义变量。 因子型变量的值是有限的、预定义的类别 (levels)。 因子型变量在统计分析中非常重要，例如，用于表示性别、学历、地区、产品类别等。 使用 <code>factor()</code> 函数创建因子型变量。</li>
<li><strong>日期型 (date):</strong> 用于表示日期数据，例如，<code>2023-10-26</code>。 R 提供了 <code>Date</code> 类型来处理日期数据。 可以使用 <code>as.Date()</code> 函数将字符型数据转换为日期型数据。</li>
<li><strong>日期时间型 (POSIXct/POSIXlt):</strong> 用于表示日期和时间数据，例如，<code>2023-10-26 10:30:00</code>。 R 提供了 <code>POSIXct</code> 和 <code>POSIXlt</code> 两种类型来处理日期时间数据。 可以使用 <code>as.POSIXct()</code> 或 <code>as.POSIXlt()</code> 函数将字符型数据转换为日期时间型数据。</li>
</ul></li>
<li><p><strong>数据类型判断和转换:</strong></p>
<ul>
<li><strong>类型判断函数:</strong> R 提供了多种函数用于判断变量的数据类型，例如：
<ul>
<li><code>is.numeric()</code>: 判断是否为数值型。</li>
<li><code>is.character()</code>: 判断是否为字符型。</li>
<li><code>is.logical()</code>: 判断是否为逻辑型。</li>
<li><code>is.factor()</code>: 判断是否为因子型。</li>
<li><code>is.Date()</code>: 判断是否为日期型。</li>
<li><code>is.POSIXct()</code> / <code>is.POSIXlt()</code>: 判断是否为日期时间型。</li>
<li><code>class()</code>: 返回变量的类型名称 (更通用)。</li>
<li><code>typeof()</code>: 返回变量的底层存储类型 (更底层)。</li>
</ul></li>
<li><strong>类型转换函数:</strong> R 提供了多种函数用于将变量从一种类型转换为另一种类型，例如：
<ul>
<li><code>as.numeric()</code>: 转换为数值型。</li>
<li><code>as.character()</code>: 转换为字符型。</li>
<li><code>as.logical()</code>: 转换为逻辑型。</li>
<li><code>as.factor()</code>: 转换为因子型。</li>
<li><code>as.Date()</code>: 转换为日期型。</li>
<li><code>as.POSIXct()</code> / <code>as.POSIXlt()</code>: 转换为日期时间型。</li>
</ul></li>
<li><strong>类型转换注意事项:</strong> 类型转换并非总是成功，需要注意数据本身的特点和转换规则。 例如，将字符型转换为数值型时，如果字符型数据不是有效的数值格式，则会转换为 <code>NA</code> (缺失值)。 将数值型转换为逻辑型时，非零数值会转换为 <code>TRUE</code>，零值会转换为 <code>FALSE</code>。</li>
</ul></li>
<li><p><strong>数据类型练习:</strong> 鼓励学生创建不同类型的变量，并使用类型判断和转换函数进行练习，例如：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 数值型</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(x)  <span class="co"># TRUE</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(x) <span class="co"># "10"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 字符型</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">"hello"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(y) <span class="co"># TRUE</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(y)  <span class="co"># NA (无法转换为数值)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 逻辑型</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">is.logical</span>(z)  <span class="co"># TRUE</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(z)  <span class="co"># 1 (TRUE 转换为 1)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="cn">FALSE</span>) <span class="co"># 0 (FALSE 转换为 0)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 因子型</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(gender) <span class="co"># TRUE</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gender)   <span class="co"># 查看因子水平</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 日期型</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>date_str <span class="ot">&lt;-</span> <span class="st">"2023-10-26"</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>date_obj <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(date_str)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="fu">is.Date</span>(date_obj) <span class="co"># TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="r-语言常用统计函数" class="level3">
<h3 class="anchored" data-anchor-id="r-语言常用统计函数">4. R 语言常用统计函数</h3>
<ul>
<li><p><strong>描述性统计函数:</strong> R 提供了丰富的函数用于计算描述性统计量，常用的函数包括：</p>
<ul>
<li><strong>中心趋势度量:</strong>
<ul>
<li><code>mean()</code>: 均值 (平均值)。</li>
<li><code>median()</code>: 中位数 (将数据排序后位于中间位置的值)。</li>
<li><code>modeest::mlv()</code>: 众数 (数据中出现频率最高的值)。 需要安装 <code>modeest</code> 包。</li>
</ul></li>
<li><strong>离散程度度量:</strong>
<ul>
<li><code>sd()</code>: 标准差 (度量数据的离散程度)。</li>
<li><code>var()</code>: 方差 (标准差的平方)。</li>
<li><code>IQR()</code>: 四分位距 (第三四分位数减去第一四分位数)。</li>
<li><code>range()</code>: 极差 (最大值减去最小值)。</li>
</ul></li>
<li><strong>位置度量:</strong>
<ul>
<li><code>quantile()</code>: 分位数 (计算指定的分位数，例如，四分位数、十分位数、百分位数)。</li>
<li><code>min()</code>: 最小值。</li>
<li><code>max()</code>: 最大值。</li>
</ul></li>
<li><strong>求和与计数:</strong>
<ul>
<li><code>sum()</code>: 求和。</li>
<li><code>length()</code>: 长度 (向量或列表的元素个数)。</li>
<li><code>count()</code> (dplyr): 计数 (统计数据框中不同值的频数)。 <code>dplyr</code> 包的函数。</li>
</ul></li>
</ul></li>
<li><p><strong>其他常用统计函数:</strong></p>
<ul>
<li><strong><code>cor()</code>: 相关系数</strong> (度量两个数值型变量之间的线性相关程度)。</li>
<li><strong><code>cov()</code>: 协方差</strong> (度量两个数值型变量的协同变化程度)。</li>
<li><strong><code>table()</code>: 频数统计表</strong> (统计分类变量的频数分布)。</li>
<li><strong><code>prop.table()</code>: 比例表</strong> (将频数统计表转换为比例)。</li>
<li><strong><code>summary()</code>: 摘要统计</strong> (提供数据的基本摘要统计信息，包括均值、中位数、最小值、最大值、四分位数等)。 <code>summary()</code> 函数可以应用于不同类型的数据，提供不同的摘要信息。</li>
</ul></li>
<li><p><strong>统计函数的使用注意事项:</strong></p>
<ul>
<li><strong>缺失值处理:</strong> R 的统计函数通常可以处理缺失值 (<code>NA</code>)。 大多数统计函数都有 <code>na.rm</code> 参数，用于控制是否移除缺失值。 <code>na.rm = TRUE</code> 表示在计算时移除缺失值，<code>na.rm = FALSE</code> (默认值) 表示如果数据中存在缺失值，则结果为 <code>NA</code>。 需要根据具体情况选择是否移除缺失值。</li>
<li><strong>数据类型:</strong> 统计函数通常只适用于数值型数据。 对于字符型、因子型等非数值型数据，需要进行适当的转换或使用其他类型的统计方法。</li>
<li><strong>函数文档:</strong> R 的统计函数都有详细的帮助文档。 可以使用 <code>?函数名</code> 或 <code>help("函数名")</code> 查看函数文档，了解函数的用法、参数和返回值。</li>
</ul></li>
<li><p><strong>统计函数练习:</strong> 使用 <code>flights</code> 数据集，练习使用常用统计函数，例如：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算 flights 数据集中 arr_delay (到达延误时间) 的均值、中位数、标准差</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(flights<span class="sc">$</span>arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(flights<span class="sc">$</span>arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(flights<span class="sc">$</span>arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算 carrier (航空公司) 的频数统计表</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(flights<span class="sc">$</span>carrier)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算 origin (出发机场) 和 dest (到达机场) 的交叉频数表</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(flights<span class="sc">$</span>origin, flights<span class="sc">$</span>dest)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 summary() 函数查看 flights 数据集的摘要统计信息</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="dplyr-包基础数据框操作利器" class="level3">
<h3 class="anchored" data-anchor-id="dplyr-包基础数据框操作利器">5. <code>dplyr</code> 包基础：数据框操作利器</h3>
<ul>
<li><p><strong><code>dplyr</code> 包简介:</strong> <code>dplyr</code> 包是 <code>tidyverse</code> 生态系统中的核心数据处理包，提供了一套简洁、高效、易用的数据框操作 “动词” (verbs)。 <code>dplyr</code> 的设计理念是 “数据操作管道” (data manipulation pipeline)，可以将多个数据操作步骤连接起来，形成清晰、可读性强的数据处理流程。 <code>dplyr</code> 是 R 语言数据分析中最常用的包之一。</p></li>
<li><p><strong><code>dplyr</code> 核心 “动词” (verbs):</strong> <code>dplyr</code> 包提供了以下几个核心 “动词”，用于完成常见的数据框操作：</p>
<ul>
<li><strong><code>filter()</code>: 筛选行</strong> (根据条件筛选数据框的行)。 类似于 SQL 中的 <code>WHERE</code> 语句。</li>
<li><strong><code>select()</code>: 选择列</strong> (选择数据框的列)。 类似于 SQL 中的 <code>SELECT</code> 语句。</li>
<li><strong><code>mutate()</code>: 创建新列或修改现有列</strong> (基于现有列计算生成新列，或修改现有列的值)。</li>
<li><strong><code>arrange()</code>: 排序</strong> (根据指定的列对数据框进行排序)。 类似于 SQL 中的 <code>ORDER BY</code> 语句。</li>
<li><strong><code>summarize()</code>: 汇总统计</strong> (对数据框进行分组汇总统计，计算各种统计量)。 类似于 SQL 中的聚合函数 (例如 <code>SUM()</code>, <code>AVG()</code>, <code>COUNT()</code>) 和 <code>GROUP BY</code> 语句。</li>
<li><strong><code>group_by()</code>: 分组</strong> (将数据框按照指定的列进行分组，为后续的汇总统计操作做准备)。 类似于 SQL 中的 <code>GROUP BY</code> 语句。</li>
</ul></li>
<li><p><strong>管道操作符 <code>%&gt;%</code>:</strong> <code>dplyr</code> 包与管道操作符 <code>%&gt;%</code> (pipe operator) 完美结合，可以实现链式数据操作。 管道操作符 <code>%&gt;%</code> 将上一步操作的结果作为下一步操作的第一个参数传入，使得代码更加简洁、易读。 管道操作符来自 <code>magrittr</code> 包，<code>tidyverse</code> 自动加载 <code>magrittr</code> 包。</p></li>
<li><p><strong><code>dplyr</code> 基础用法示例 (使用 <code>flights</code> 数据集):</strong></p>
<ul>
<li><p><strong>筛选行 (<code>filter()</code>):</strong> 筛选出所有 1 月份 (month == 1) 的航班。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>january_flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(january_flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>%&gt;%</code> 管道操作符:</strong> <code>flights %&gt;% filter(month == 1)</code> 表示将 <code>flights</code> 数据框作为 <code>filter()</code> 函数的第一个参数传入。</li>
<li><strong><code>filter(month == 1)</code>:</strong> 筛选条件是 <code>month == 1</code>，表示 <code>month</code> 列的值等于 1。 <code>==</code> 是等于比较运算符。</li>
</ul></li>
<li><p><strong>选择列 (<code>select()</code>):</strong> 选择 <code>year</code>, <code>month</code>, <code>day</code>, <code>carrier</code>, <code>flight</code>, <code>dep_delay</code>, <code>arr_delay</code> 这几列。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>selected_cols_flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, month, day, carrier, flight, dep_delay, arr_delay)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(selected_cols_flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>select(year, month, day, carrier, flight, dep_delay, arr_delay)</code>:</strong> 直接列出要选择的列名即可。</li>
</ul></li>
<li><p><strong>创建新列 (<code>mutate()</code>):</strong> 创建一个新列 <code>gain</code>，表示航班的实际飞行时间 (到达时间 - 出发时间 - 计划飞行时间)。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>flights_with_gain <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gain =</span> arr_time <span class="sc">-</span> dep_time <span class="sc">-</span> air_time)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(flights_with_gain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>mutate(gain = arr_time - dep_time - air_time)</code>:</strong> <code>gain = ...</code> 表示创建名为 <code>gain</code> 的新列，等号右边是计算新列值的表达式。</li>
</ul></li>
<li><p><strong>排序 (<code>arrange()</code>):</strong> 按照出发延误时间 <code>dep_delay</code> 进行升序排序。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>arranged_flights <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dep_delay)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(arranged_flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>arrange(dep_delay)</code>:</strong> 按照 <code>dep_delay</code> 列进行升序排序。 默认升序。 降序排序可以使用 <code>desc(dep_delay)</code>。</li>
</ul></li>
<li><p><strong>汇总统计 (<code>summarize()</code>):</strong> 计算所有航班的平均到达延误时间 <code>arr_delay</code>。</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>average_delay <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(average_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>summarize(mean_delay = mean(arr_delay, na.rm = TRUE))</code>:</strong> <code>mean_delay = ...</code> 表示创建一个名为 <code>mean_delay</code> 的汇总统计量，等号右边是计算汇总统计量的表达式，这里使用 <code>mean()</code> 函数计算平均值，<code>na.rm = TRUE</code> 表示移除缺失值。</li>
</ul></li>
<li><p><strong>分组汇总 (<code>group_by()</code> + <code>summarize()</code>):</strong> 按照航空公司 <code>carrier</code> 分组，计算每个航空公司的平均到达延误时间。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>carrier_delay <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(carrier_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>group_by(carrier)</code>:</strong> 按照 <code>carrier</code> 列进行分组。 后续的 <code>summarize()</code> 操作将在每个分组内进行。</li>
<li><strong><code>summarize(mean_delay = mean(arr_delay, na.rm = TRUE))</code>:</strong> 在每个航空公司分组内计算平均到达延误时间。</li>
</ul></li>
</ul></li>
<li><p><strong><code>dplyr</code> 练习:</strong> 鼓励学生使用 <code>dplyr</code> 的各种 “动词” 和管道操作符，对 <code>flights</code> 数据集进行各种数据操作练习，例如：</p>
<ul>
<li>筛选出到达延误时间超过 60 分钟的航班。</li>
<li>选择 <code>carrier</code>, <code>flight</code>, <code>dep_delay</code>, <code>arr_delay</code> 和 <code>distance</code> 列，并按照飞行距离 <code>distance</code> 进行降序排序。</li>
<li>创建新列 <code>speed</code>，表示航班的平均飞行速度 (距离 / 飞行时间)。</li>
<li>按照出发机场 <code>origin</code> 分组，计算每个出发机场的航班数量和平均出发延误时间。</li>
<li>尝试组合多个 <code>dplyr</code> 动词，完成更复杂的数据操作任务。</li>
</ul></li>
<li><p><strong>AI 辅助 <code>dplyr</code> 使用 (可选):</strong> 演示如何使用 AI 插件辅助 <code>dplyr</code> 包的使用。 例如：</p>
<ul>
<li><strong>函数用法查询:</strong> 使用 AI 聊天提问： “<code>filter()</code> function in R <code>dplyr</code> package”, “how to use <code>group_by()</code> and <code>summarize()</code> in <code>dplyr</code>”。 AI 可能会提供函数文档或使用示例。</li>
<li><strong>代码补全:</strong> 在 VS Code/Cursor 中输入 <code>flights %&gt;% fil</code>，AI 插件会自动提示 <code>filter()</code> 函数，并提供函数参数提示。</li>
<li><strong>代码示例生成:</strong> 使用 AI 代码生成功能，输入注释: <code># R code to filter flights data for month == 2 and carrier == "AA" using dplyr</code>, 让 AI 生成代码。</li>
<li><strong>代码解释:</strong> 使用 AI 代码解释功能，选中 <code>dplyr</code> 代码片段，让 AI 解释代码的功能和每一行代码的作用。</li>
</ul></li>
</ul>
</section>
<section id="本周内容总结与下周预告" class="level3">
<h3 class="anchored" data-anchor-id="本周内容总结与下周预告">6. 本周内容总结与下周预告</h3>
<ul>
<li><p><strong>本周回顾:</strong> 回顾本周学习内容，巩固重点知识。 本周我们<strong>深入学习</strong>了 R 语言数据导入的常用包 <code>readr</code> 和 <code>datatable</code>，对比了它们的特点和适用场景，学习了 R 的基本数据类型和常用统计函数，并初步掌握了 <code>dplyr</code> 包的基本用法。 <strong>数据导入、数据类型、统计函数和 <code>dplyr</code> 是 R 语言数据分析的基础，务必熟练掌握本周所学内容。</strong></p></li>
<li><p><strong>下周预告:</strong> 下周我们将继续深入学习 <code>dplyr</code> 包，学习更高级的数据操作技巧，例如，多表连接 (join)、数据变形 (reshape)、窗口函数 (window function) 等。 <code>dplyr</code> 是数据清洗和预处理的利器，下周我们将重点学习如何使用 <code>dplyr</code> 进行高效的数据清洗和预处理。</p></li>
</ul>
</section>
<section id="课后任务" class="level3">
<h3 class="anchored" data-anchor-id="课后任务">7. 课后任务</h3>
<ul>
<li><strong>小组任务:</strong>
<ul>
<li><strong>继续项目一数据探索:</strong> 各小组继续使用 R 语言导入和探索项目一的数据集，尝试使用 <code>readr</code> 或 <code>datatable</code> 包导入数据，并使用本周学习的 R 基础知识和 <code>dplyr</code> 包进行初步的数据查看和理解。</li>
<li><strong>小组讨论数据清洗方案:</strong> 小组讨论项目一的数据清洗和预处理方案，为下周的数据清洗任务做好准备。</li>
</ul></li>
<li><strong>个人任务:</strong>
<ul>
<li><strong>复习本周内容:</strong> 回顾本周讲义和课堂笔记，巩固 <code>readr</code> 和 <code>datatable</code> 包的用法、R 基本数据类型、常用统计函数和 <code>dplyr</code> 基础用法。</li>
<li><strong>R 代码练习:</strong> 完成本讲义中布置的 R 代码练习，熟练掌握 <code>readr</code>, <code>datatable</code>, R 基础函数和 <code>dplyr</code> 包的常用函数。 尝试使用 AI 插件辅助 R 代码练习。</li>
<li><strong><code>flights</code> 数据集练习:</strong> 使用 <code>flights</code> 数据集，练习使用 <code>readr</code> 和 <code>datatable</code> 进行数据导入导出，练习使用 R 基本数据类型和统计函数，练习使用 <code>dplyr</code> 包进行数据操作。 可以尝试完成讲义中提供的练习题，也可以自己设计练习题。</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
AI 辅助学习小贴士
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>R 代码练习:</strong> 继续在 VS Code 或 Cursor 中练习 R 语言代码，充分利用 AI 插件的代码自动补全、代码生成、代码解释、AI 聊天等功能。 遇到 R 代码问题，及时向 AI 提问。</li>
<li><strong>数据包使用问题:</strong> 如果在使用 <code>readr</code>, <code>datatable</code>, <code>dplyr</code> 等数据包时遇到问题，可以查阅包的官方文档，或者使用 AI 聊天提问，寻求帮助。</li>
<li><strong>统计概念理解:</strong> 如果对某些统计概念 (例如，均值、中位数、标准差、相关系数等) 理解不透彻，可以使用 AI 聊天提问，让 AI 提供更详细的解释和例子。</li>
<li><strong>代码效率优化:</strong> 如果希望提高 R 代码的运行效率，可以尝试使用 <code>datatable</code> 包，或者使用 AI 聊天咨询代码优化技巧。</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
学习寄语
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>工欲善其事，必先利其器！ 本周我们学习了 R 语言数据导入和数据处理的利器，为后续的数据分析打下了坚实的基础。 熟练掌握这些工具，您将能够更高效地进行数据分析！</strong> 继续保持学习的热情，充分利用 VS Code/Cursor 和 AI 插件的强大功能，相信大家会在统计学和 R 语言的学习中取得更大的进步！ 下周见！</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week01.html" class="pagination-link" aria-label="第一周：项目启动与统计学导论">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">第一周：项目启动与统计学导论</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./week03.html" class="pagination-link" aria-label="统计学讲义 - 第三周：描述性统计：数据探索与可视化">
        <span class="nav-page-text"><span class="chapter-title">统计学讲义 - 第三周：描述性统计：数据探索与可视化</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>