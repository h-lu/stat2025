```{r setup, include=FALSE}
# åŠ è½½å¿…è¦çš„åŒ…
# ä½¿ç”¨pacmanåŒ…æ›´æ–¹ä¾¿åœ°åŠ è½½å’Œç®¡ç†åŒ…
if (!requireNamespace("pacman", quietly = TRUE)) {
  install.packages("pacman")
}
pacman::p_load(tidyverse, readr, ggplot2, showtext, patchwork, broom, knitr, emojifont, fontawesome, ggsci, ggimage, kableExtra, ggforce, ggridges, viridis, forcats, ggrepel)

# è®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ
font_add_google("Noto Sans SC", "noto_sans")  # æ€æºé»‘ä½“
showtext_auto()

# è‡ªå®šä¹‰ä¸»é¢˜
food_theme <- theme_minimal() +
  theme(
    text = element_text(family = "noto_sans", size = 12),
    plot.title = element_text(family = "noto_sans", size = 16, face = "bold", color = "#333333"),
    plot.subtitle = element_text(family = "noto_sans", size = 12, color = "#666666"),
    axis.title = element_text(family = "noto_sans", size = 11, color = "#333333"),
    axis.text = element_text(family = "noto_sans", size = 10, color = "#666666"),
    legend.title = element_text(family = "noto_sans", size = 11, color = "#333333"),
    legend.text = element_text(family = "noto_sans", size = 10, color = "#666666"),
    panel.grid.major = element_line(color = "#DDDDDD"),
    panel.grid.minor = element_line(color = "#EEEEEE"),
    panel.background = element_rect(fill = "#FFFFFF"),
    plot.background = element_rect(fill = "#FFFFFF", color = NA)
  )

# è®¾ç½®ç¾é£Ÿç›¸å…³çš„é…è‰²æ–¹æ¡ˆ
food_colors <- c(
  "ç”œç‚¹" = "#FF9999",       # ç²‰çº¢è‰² - ç”œç‚¹
  "è‚‰ç±»" = "#CD5C5C",       # çº¢è‰² - è‚‰ç±»
  "è”¬æœ/ç´ é£Ÿ" = "#90EE90",  # ç»¿è‰² - è”¬æœ
  "å¿«é¤" = "#FFD700",       # é‡‘è‰² - å¿«é¤
  "æµ·é²œ" = "#87CEEB",       # è“è‰² - æµ·é²œ
  "æ±¤/é¥®å“" = "#B0C4DE",    # æ·¡è“è‰² - æ±¤/é¥®å“
  "åŠ¨ç‰©æ€§" = "#A52A2A",     # æ£•è‰² - åŠ¨ç‰©æ€§
  "æ¤ç‰©æ€§" = "#228B22",     # æ£®æ—ç»¿ - æ¤ç‰©æ€§ 
  "æ··åˆ/å…¶ä»–" = "#DDA0DD"   # ç´«è‰² - æ··åˆ/å…¶ä»–
)

# åˆ›å»ºæ¼‚äº®çš„è¡¨æ ¼å‡½æ•°
pretty_table <- function(data, caption = NULL) {
  data %>%
    kbl(caption = caption, booktabs = TRUE, align = "c") %>%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed"), 
                  full_width = FALSE, position = "center") %>%
    row_spec(0, bold = TRUE, color = "#FFFFFF", background = "#FF6B6B")
}

# è‡ªå®šä¹‰æç¤ºæ¡†å‡½æ•°
food_note <- function(text) {
  htmltools::div(
    class = "food-note",
    htmltools::HTML(paste0("ğŸ½ï¸ ", text))
  )
}

# è®¾ç½®å›¾è¡¨ä¿å­˜è·¯å¾„
if (!dir.exists("images")) {
  dir.create("images")
}

# è‡ªå®šä¹‰é…è‰²æ–¹æ¡ˆå‡½æ•°
get_food_palette <- function(n) {
  colorRampPalette(c("#FF9999", "#CD5C5C", "#90EE90", "#FFD700", "#87CEEB", "#B0C4DE"))(n)
}
``` 